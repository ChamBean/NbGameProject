var App=function(){function t(){this.resManager=null,this.configManager=null}var e=__define,i=t,n=i.prototype;return n.init=function(t){this.stage=t,LoopManager.init(t),this.layer=new LayerManager,this.resManager=new ResourceManager,this.configManager=new LoadConfigManager,this.resManager.initLoopClear()},e(t,"ins",function(){return null==t._ins&&(t._ins=new t),t._ins}),t}();egret.registerClass(App,"App");var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?n(r):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var CBitmapData=function(){function t(t,e){this._count=0,this._texture=e,this._url=t}var e=__define,i=t,n=i.prototype;return e(n,"width",function(){return null==this._texture?0:this._texture.bitmapData.width}),e(n,"height",function(){return null==this._texture?0:this._texture.bitmapData.height}),n.count=function(t){void 0===t&&(t=!0),t?this._count++:this._count--,0==this._count&&(this._lastTime=egret.getTimer())},e(n,"url",function(){return this._url}),e(n,"texture",function(){return this._texture}),n.dispose=function(){this._count>0||LoopManager.currentTime-this._lastTime<3e4||(this._texture.dispose(),this._texture=null)},t}();egret.registerClass(CBitmapData,"CBitmapData");var LayerManager=function(){function t(){this.sceneLayer=new egret.Sprite,this.mainLayer=new egret.Sprite,this.moduleLayer=new egret.Sprite,this.windowLayer=new egret.Sprite,this.popAlertLayer=new egret.Sprite,this.msgLayer=new egret.Sprite,this.topLayer=new egret.Sprite}var e=(__define,t),i=e.prototype;return i.initLayer=function(t){this.container=t,t.addChild(this.sceneLayer),t.addChild(this.mainLayer),t.addChild(this.moduleLayer),t.addChild(this.windowLayer),t.addChild(this.popAlertLayer),t.addChild(this.msgLayer),t.addChild(this.topLayer),UiManager.init()},t}();egret.registerClass(LayerManager,"LayerManager");var LoadConfigManager=function(){function t(){this._configs={},this._loadDic={}}var e=(__define,t),i=e.prototype;return i.getConfig=function(t,e,i,n,r){void 0===i&&(i=null),void 0===n&&(n=0),void 0===r&&(r=null);var a=this._configs[t];if(null==a){var o=this._loadDic[t];null==o&&(o=[],this._loadDic[t]=o,LoadManager.ins.addTextLoad(t,this.onConfigComplete,this,n,r)),o.push({fun:e,data:i})}else{var s={cfg:a,data:i,url:t};e(s)}},i.onConfigComplete=function(t){var e=t.url,i=t.info,n=i._loadDic[e],r=t.data;i._configs[e]=r;for(var a=0;a<n.length;a++){var o=n[a],s={cfg:r,data:o.data,url:e};o.fun(s)}i._loadDic[e]=null,delete i._loadDic[e]},t}();egret.registerClass(LoadConfigManager,"LoadConfigManager");var ResourceManager=function(){function t(){this._inited=!1,this.second=0,this._images={},this._loadDic={}}var e=(__define,t),i=e.prototype;return i.getImageRes=function(t,e,i,n,r){void 0===i&&(i=null),void 0===n&&(n=0),void 0===r&&(r=null);var a=this._images[t];if(null==a){var o=this._loadDic[t];null==o&&(o=[],this._loadDic[t]=o,LoadManager.ins.addImgLoad(t,this.onImageComplete,this,n,r)),o.push({fun:e,data:i})}else{var s={bmd:a,data:i,url:t};e(s)}},i.onImageComplete=function(t){var e=t.info,i=t.url,n=e._loadDic[i],r=t.data,a=new CBitmapData(i,r);e._images[i]=a;for(var o=0;o<n.length;o++){var s=n[o],h={bmd:a,data:s.data,url:i};s.fun(h)}e._loadDic[i]=null,delete e._loadDic[i]},i.loadCompletedByUrl=function(t){return this._images[t]?!0:!1},i.initLoopClear=function(){0==this._inited?(LoopManager.addToSecond("ImageRescourceLoop",this.gc,this),this._inited=!0):(this.second=300,this.gc(this))},i.gc=function(t){if(t.second++,!(t.second<=300)){t.second=0;var e,i={};for(var n in t._images){var e=t._images[n];e.dispose(),null!=e.texture&&(i[n]=e)}t._images=i}},t}();egret.registerClass(ResourceManager,"ResourceManager");var AcorrsLineGrid=function(){function t(t,e){void 0===e&&(e=null),this._isPanX=!1,this._isPanY=!1,this._mapvo=t,this._astartNodes=e,this.nodes=this._mapvo.nodeArray,this.nodeWidth=this._mapvo.nodeWidth,this.nodeHeight=this._mapvo.nodeHeight,this.arrange=new Arrange,this.arrange.key="f"}var e=(__define,t),i=e.prototype;return i.reset=function(t){this._mapvo=t,this.nodes=this._mapvo.nodeArray,this.nodeWidth=this._mapvo.nodeWidth,this.nodeHeight=this._mapvo.nodeHeight},i.getPsnode=function(t){if(null==t&&(t=this._astartNodes),null==t||null==this._mapvo)throw new Error("没有合适节点可供计算：in AcorrsLineGrid");var e=t.length;if(3>e)return t;var i=[],n=t[0],r=t[e-1],a=0;for(i.push(n);n!=r;)for(var o=e-1;o>a;o--){var s=t[o],h=o-a==1?!0:!1;if(h||this.isCorrsed(n,s)){n=s,a=o,i.push(s);break}}return i},i.isCorrsed=function(t,e){function i(t,e){return e._isPanY?e._panYvalue:(t-e._b)/e._k}function n(t,e){return e._isPanX?e._panXvalue:e._k*t+e._b}function r(t,e){var i,n,r=a(t);switch(r){case 4:i=e.nodes[t.y][t.x-1],n=e.nodes[t.y-1][t.x];break;case-2:i=e.nodes[t.y][t.x-1],n=e.nodes[t.y+1][t.x];break;case-4:i=e.nodes[t.y][t.x+1],n=e.nodes[t.y+1][t.x];break;case 2:i=e.nodes[t.y][t.x+1],n=e.nodes[t.y+1][t.x];break;default:return!1}return i.walkAble||n.walkAble?!1:!0}function a(t){var e=3*(t.y-o.y)+(t.x-o.x);return e}if(!t||!e)return!1;this._isPanX=t.y==e.y,this._isPanY=t.x==e.x,this._isPanX||this._isPanY?(this._isPanX&&(this._panXvalue=t.y*this.nodeHeight),this._isPanY&&(this._panYvalue=t.x*this.nodeWidth)):(this._k=(e.y-t.y)*this.nodeHeight/((e.x-t.x)*this.nodeWidth),this._b=(e.y+.5)*this.nodeHeight-(e.x+.5)*this.nodeWidth*this._k);var o,s,h,l,d=Math.min(e.x,t.x),u=Math.max(e.x,t.x),c=Math.min(t.y,e.y),_=Math.max(t.y,e.y),p=(d+.5)*this.nodeWidth,g=(u+.5)*this.nodeWidth,m=(c+.5)*this.nodeHeight,f=(_+.5)*this.nodeHeight;o=t.x<e.x?t:e;var v;for(v=d;u>=v;v++){if(s=v*this.nodeWidth+1,s>=p&&g>=s){if(h=n(s,this),l=this._mapvo.getNodeByXY(s,h),!l.walkAble)return!1;if(r(l,this))return!1;o=l}if(s=(v+1)*this.nodeWidth-1,s>=p&&g>=s){if(h=n(s,this),l=this._mapvo.getNodeByXY(s,h),!l.walkAble)return!1;if(r(l,this))return!1;o=l}}for(l=t.y<e.y?t:e,v=c;_>=v;v++){if(h=v*this.nodeHeight+1,h>=m&&f>=h){if(s=i(h,this),l=this._mapvo.getNodeByXY(s,h),!l.walkAble)return!1;if(r(l,this))return!1;o=l}if(h=(v+1)*this.nodeHeight-1,h>=m&&f>=h){if(s=i(h,this),l=this._mapvo.getNodeByXY(s,h),!l.walkAble)return!1;if(r(l,this))return!1;o=l}}return!0},t}();egret.registerClass(AcorrsLineGrid,"AcorrsLineGrid");var Arrange=function(){function t(){this._desending=!0,this.init()}var e=__define,i=t,n=i.prototype;return n.init=function(){this._arr=[],this._compareFun=this.compares},e(n,"desending",void 0,function(t){this._desending=t}),n.put=function(t){var e=this._arr.length;if(1>e)return void this._arr.push(t);for(var i=0,n=e-1;e>1;){var r=Math.floor(i+e/2),a=this._compareFun(t,this._arr[r]);switch(a){case-1:i=r;break;case 0:return void this._arr.splice(r,0,t);case 1:n=r}e=n-i}return a=this._compareFun(t,this._arr[i]),1==a||0==a?void this._arr.splice(i,0,t):(a=this._compareFun(t,this._arr[n]),1==a||0==a?void this._arr.splice(n,0,t):void this._arr.splice(n+1,0,t))},e(n,"key",void 0,function(t){null!=t&&""!=t&&(this._key=t)}),e(n,"compareWitchNum",void 0,function(t){t&&(this._compareFun=this.cwitchNum)}),n.cwitchNum=function(t,e){var i=t-e;return this._desending||(i*=-1),0>i?-1:i>0?1:0},n.compares=function(t,e){var i=t[this._key]-e[this._key];return this._desending||(i*=-1),0>i?-1:i>0?1:0},n.pop=function(){return this._arr.pop()},n.shift=function(){return this._arr.shift()},e(n,"array",function(){return this._arr}),n.clear=function(){this._arr=[]},n.rePlaceArr=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=""),null==t||t.length<2)return t;(null==i||""==i)&&(this._compareFun=this.cwitchNum),this.desending=e,this.clear();for(var n in t)this.put(t[n]);return t=this.array},t}();egret.registerClass(Arrange,"Arrange");var Astart=function(){function t(){this._version=0,this.sqrt_2=Math.SQRT2}var e=(__define,t),i=e.prototype;return t.findPath=function(e){return null==e||null==e.startNode||null==e.endNode?null:(null==t._instance&&(t._instance=new t),t._instance.hasPath(e))},i.hasPath=function(e){t._onlyIdNum++,t._vistedNum=0,this._arrange=new Arrange,this._arrange.key="h",this._findFun=this.euclidian,this._startNode=e.startNode,this._endNode=e.endNode;var i=this._startNode;i.f=0,i.g=i.h=0;for(var n=e.col-1,r=e.row-1,a=e.nodeArray,o=0,s=0,h=t._onlyIdNum;i!=this._endNode;){var l=i.x-1,d=i.x+1,u=i.y-1,c=i.y+1;0>l&&(l=0),d>n&&(d=n),0>u&&(u=0),c>r&&(c=r);for(var _=l;d>=_;_++)for(var p=u;c>=p;p++){t._vistedNum++;var g=a[p][_];if(g.visitTime!=h&&(g.visited=!1,g.visitTime=h),null!=g&&g.walkAble&&g!=i){var m=!(g.x==i.x||g.y==i.y);if(m){var f=a[g.y][i.x],v=a[i.y][g.x];if(0==f.walkAble&&0==v.walkAble)continue}var E=m?1.4:1,y=i.f+E;g.visited?(o++,g.f>y&&(g.f=y,g.h=g.f+g.g,g.parent=i)):(s++,g.visited=!0,g.f=y,g.g=this._findFun(g),g.h=g.f+g.g,g.parent=i,this._arrange.put(g))}}if(i=this._arrange.pop(),null==i)return null}for(var M=[];i!=this._startNode;)M.push(i),i=i.parent;return M.push(i),t.ProfectPath&&(M=t.profect(M)),M},t.profect=function(t){function e(t){return 10*(t.y-o.y)+(t.x-o.x)}if(null==t||t.length<3)return t;var i,n,r,a=[],o=t[0],s=e(t[1]);a.push(o);for(var h,l=(egret.getTimer(),1);l<t.length;l++)r=t[l],n=e(r),n!=s?(h++,i&&a.push(i),i=r,s=n):i=r,o=r;return a.push(i),a},i.euclidian=function(t){var e=this._endNode.x-t.x,i=this._endNode.y-t.y;return e*e+i*i},i.diagonal=function(t){var e=this._endNode.x-t.x,i=this._endNode.y-t.y;0>e&&(e*=-1),0>i&&(i*=-1);var n=i>e?e:i;return n*this.sqrt_2+(e+i-2*n)},i.manhattan=function(t){var e=this._endNode.x-t.x,i=this._endNode.y-t.y;return 0>e&&(e*=-1),0>i&&(i*=-1),e+i},t.ProfectPath=!1,t._vistedNum=0,t._onlyIdNum=0,t}();egret.registerClass(Astart,"Astart");var MapNode=function(){function t(t){this.visited=!1,this.visitTime=0,this.isMask=!1,this.isSwim=!1,this.isSafe=!0,this.walkAble=!0}var e=(__define,t),i=e.prototype;return i.reset=function(){this.f=0,this.g=0,this.h=0,this.x=0,this.y=0,this.visitTime=0,this.walkAble=!0,this.visited=!1,this.isMask=!1,this.isSwim=!1,this.isSafe=!0},t.getNode=function(){var e;return 0==t.nodePool.length?(e=new t(new Single),t.numCount++):e=t.nodePool.shift(),e},i.dispose=function(){this.reset(),t.nodePool.push(this)},t.nodePool=[],t.numCount=0,t}();egret.registerClass(MapNode,"MapNode");var Single=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(Single,"Single");var MapConfig=function(){function t(){}var e=(__define,t);e.prototype;return t.MAP_SCREEN_WIDTH=480,t.MAP_SCREEN_HEIGHT=800,t.MAP_CLIP_IMAGE_WIDTH=256,t.MAP_CLIP_IMAGE_HEIGHT=256,t.MAP_NODE_WIDTH=64,t.MAP_NODE_HEIGHT=64,t.version="",t.res_url="map/",t}();egret.registerClass(MapConfig,"MapConfig");var MapDataConvert=function(){function t(){}var e=(__define,t),i=e.prototype;return i.numbertranfromToMapVO=function(t){return this.convertMapVO(t)},i.convertMapVO=function(t){var e=new egret.ByteArray(t);null==this.mapdata?this.mapdata=new MapVo:this.mapdata.dispose();var i=this.mapdata;e.position=4,i.version=e.readFloat();var n=e.readInt();e.position=42,i.col=this.readShort(e),i.row=this.readShort(e),e.position+=2,i.nodeArray=[],i.doors=[];for(var r,a=0;a<i.col;a++)for(var o=0;o<i.row;o++){null==i.nodeArray[o]&&(i.nodeArray[o]=[]);var s=e.readByte(),h=(1&s)>0?!0:!1,l=(16&s)>0?!0:!1,d=(2&s)>0?!0:!1,u=(8&s)>0?!0:!1,c=0;h?(c=1,l&&(c=2)):c=0,r=MapNode.getNode(),r.x=a,r.y=o,r.isMask=l,r.isSwim=d,r.walkAble=h,r.isSafe=u,i.nodeArray[o][a]=r,e.position+=1}i.mapWidth=e.readShort(),i.mapHeight=e.readShort(),i.nodeWidth=e.readShort(),i.nodeHeight=e.readShort(),i.tileWidth=e.readShort(),i.tileHeight=e.readShort();var _=Math.ceil(i.mapWidth/MapConfig.MAP_CLIP_IMAGE_WIDTH),p=Math.ceil(i.mapHeight/MapConfig.MAP_CLIP_IMAGE_HEIGHT);for(i.tileArray=[],a=0;p>a;a++)for(null==i.tileArray[a]&&(i.tileArray[a]=[]),o=0;_>o;o++)i.tileArray[a][o]=o+"_"+a+".jpg";var g=[];if(n>0)for(a=0;n>a;a++){var m=new MapEffectVo;m.tempID=a,m.sid=e.readInt(),m.sx=e.readShort(),m.sy=e.readShort(),m.scaleX=e.readDouble(),m.scaleY=e.readDouble(),m.rotation=e.readInt(),g.push(m)}return i.mapEffectList=g,i.mapId=parseInt(e.readUTF()),i.previewImageUrl=e.readUTF(),e.clear(),i},i.readShort=function(t){var e=new egret.ByteArray,i=t.readByte(),n=t.readByte();return e.writeByte(n),e.writeByte(i),e.position=0,e.readShort()},t}();egret.registerClass(MapDataConvert,"MapDataConvert");var MapLoadProxy=function(t){function e(){t.call(this),this._mapConvert=null,this._mapData=null,this._waitClips={},this._mapConvert=new MapDataConvert}__extends(e,t);var i=__define,n=e,r=n.prototype;return r.setBgView=function(t){this._bgView=t},r.setMapId=function(t){this._mapid=t;var i=StringUtil.substitute(e.mapCfgSrc,t);LoadManager.ins.addByteLoad(i,this.onLoadMapCfgHandler,this,LoadPriorityEnum.MAPCONFIG_PRIORITY),this.loadSmallMap()},r.onLoadMapCfgHandler=function(t){var e=t.info;e._mapData=e._mapConvert.numbertranfromToMapVO(t.data),e._mapData.mapId=e._mapid,e.dispatchEventWith(SceneEventName.GAMEMAP_DATA_LOAD_COMPLETE,!1,e._mapData),e.drawMark()},i(r,"mapData",function(){return this._mapData}),r.loadSmallMap=function(){this._previewTexture=null;var t=StringUtil.substitute(e.mapClipSrc,this._mapid,"preview.jpg");LoadManager.ins.addImgLoad(t,this.onLoadSmallMapComplete,this,LoadPriorityEnum.MAPCONFIG_PRIORITY)},r.onLoadSmallMapComplete=function(t){var e=t.info;e._previewTexture=t.data,e.drawMark()},r.drawMark=function(){null!=this._mapData&&null!=this._previewTexture&&this._bgView.setMark(this._previewTexture,this._mapData.mapWidth,this._mapData.mapHeight)},r.loadClips=function(t){for(var i=this._mapData,n=0;n<t.length;n++){var r=t[n];if(i.tileArray[r.x]&&i.tileArray[r.x][r.y]){var a=i.tileArray[r.x][r.y],o=StringUtil.substitute(e.mapClipSrc,i.mapId,a);if(this._bgView.hasClipBmp(o)||null!=this._waitClips[o])continue;this._waitClips[o]=o;var s={mapid:i.mapId,url:o,self:this,x:r.x,y:r.y};LoadManager.ins.addImgLoad(o,this.loadMapComplete,s,LoadPriorityEnum.MAPCLIP_PRIORITY)}}},r.loadMapComplete=function(t){var e=t.info,i=e.self,n=e.x,r=e.y,a=e.url,o=e.mapid;if(i._mapid==o){i._waitClips[a]=null,delete i._waitClips[a];var s=new egret.Bitmap(t.data);s.x=n*MapConfig.MAP_CLIP_IMAGE_WIDTH,s.y=r*MapConfig.MAP_CLIP_IMAGE_HEIGHT,i._bgView.setClipBmd(a,s)}},r.clear=function(){for(var t in this._waitClips)LoadManager.ins.clearLoad(t);this._waitClips={},this._mapData=null},e.mapCfgSrc="resource/map/map{0}/data.mp",e.mapClipSrc="resource/map/map{0}/{1}",e}(egret.EventDispatcher);egret.registerClass(MapLoadProxy,"MapLoadProxy");var MapSceneProxy=function(){function t(){this._mapArea=null,this._sceneRect=null,this._rolePoint=null,this.init()}var e=__define,i=t,n=i.prototype;return n.init=function(){this._rolePoint=new egret.Point(0,0),this._mapArea=new egret.Rectangle(0,0,0,0),this._sceneRect=new egret.Rectangle(0,0,MapConfig.MAP_SCREEN_WIDTH,MapConfig.MAP_SCREEN_HEIGHT)},e(n,"sceneRect",function(){return this._sceneRect}),n.upMapAreaRect=function(t,e,i){void 0===i&&(i=!1),this._mapArea.width=t,this._mapArea.height=e,i&&this.moveScene()},n.upSceneRect=function(t,e,i){void 0===i&&(i=!1),this._sceneRect.width=t,this._sceneRect.height=e,MapConfig.MAP_SCREEN_WIDTH=t,MapConfig.MAP_SCREEN_HEIGHT=e,i&&this.moveScene()},n.setRolePoint=function(t,e,i){void 0===i&&(i=!1),this._rolePoint.x=t,this._rolePoint.y=e,i&&this.moveScene()},n.moveScene=function(){this.sceneRect.x=this._rolePoint.x-this.sceneRect.width/2,this.sceneRect.y=this._rolePoint.y-this.sceneRect.height/2,this.sceneRect.width>this._mapArea.width?this.sceneRect.x=(this._mapArea.width-this.sceneRect.width)/2:this.sceneRect.x<0?this.sceneRect.x=0:this.sceneRect.x+this.sceneRect.width>this._mapArea.width&&(this.sceneRect.x=this._mapArea.width-this.sceneRect.width),this.sceneRect.height>this._mapArea.height?this.sceneRect.y=(this._mapArea.height-this.sceneRect.height)/2:this.sceneRect.y<0?this.sceneRect.y=0:this.sceneRect.y+this.sceneRect.height>this._mapArea.height&&(this.sceneRect.y=this._mapArea.height-this.sceneRect.height)},e(n,"clips",function(){for(var t=[],e=(SceneManager.ins.mapData,Math.floor((this._sceneRect.x-MapConfig.MAP_CLIP_IMAGE_WIDTH)/MapConfig.MAP_CLIP_IMAGE_WIDTH)),i=Math.floor((this._sceneRect.y-MapConfig.MAP_CLIP_IMAGE_HEIGHT)/MapConfig.MAP_CLIP_IMAGE_HEIGHT),n=Math.floor((this._sceneRect.x+this._sceneRect.width+MapConfig.MAP_CLIP_IMAGE_WIDTH)/MapConfig.MAP_CLIP_IMAGE_WIDTH),r=Math.floor((this._sceneRect.y+this._sceneRect.height+MapConfig.MAP_CLIP_IMAGE_HEIGHT)/MapConfig.MAP_CLIP_IMAGE_HEIGHT),a=e;n>=a;a++)for(var o=i;r>o;o++)t.push({x:a,y:o});return t}),t}();egret.registerClass(MapSceneProxy,"MapSceneProxy");var MapEffectVo=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(MapEffectVo,"MapEffectVo");var MapVo=function(){function t(){this.mapWidth=0,this.mapHeight=0,this.row=0,this.col=0,this.version=0}var e=(__define,t),i=e.prototype;return i.dispose=function(){if(null!=this.nodeArray){for(var t=0;t<this.nodeArray.length;t++)for(var e=0;e<this.nodeArray[t].length;e++)this.nodeArray[t][e].dispose();this.nodeArray=null}},i.getNodeByXY=function(t,e){var i=t/this.nodeWidth,n=e/this.nodeHeight;return this.getNode(i,n)},i.getNode=function(t,e){return t=Math.floor(t),e=Math.floor(e),e>=0&&t>=0&&e<this.row&&t<this.col?this.nodeArray[e][t]:null},t.transNodePoint=function(t,e){return void 0===e&&(e=null),null==e&&(e=new egret.Point(0,0)),e.x=(t.x+.5)*MapConfig.MAP_NODE_WIDTH,e.y=(t.y+.5)*MapConfig.MAP_NODE_HEIGHT,e},t.getCenterPoint=function(t,e){var i=new egret.Point;return i.x=(t+.5)*MapConfig.MAP_NODE_WIDTH,i.y=(e+.5)*MapConfig.MAP_NODE_HEIGHT,i},t.getPoint=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=new egret.Point;return n},t}();egret.registerClass(MapVo,"MapVo");var SceneEventName=function(){function t(){}var e=(__define,t);e.prototype;return t.UPDATA_ROLE_SIZE="updataRoleSize",t.GAMEMAP_DATA_LOAD_COMPLETE="gameMap_data_load_complete",t.MY_ROLE_CHANGE_POSITION="my_role_change_position",t}();egret.registerClass(SceneEventName,"SceneEventName");var BaseMapLayer=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.clear=function(){},e}(egret.DisplayObjectContainer);egret.registerClass(BaseMapLayer,"BaseMapLayer");var MapAvatarLayer=function(t){function e(){t.call(this),this._childList=[]}__extends(e,t);var i=(__define,e),n=i.prototype;return n.init=function(){},n.addChild=function(e){return-1!=this._childList.indexOf(e)?e:(this._childList.push(e),t.prototype.addChild.call(this,e))},n.removeChild=function(e){var i=this._childList.indexOf(e);return-1==i?e:(this._childList.splice(i,1),t.prototype.addChild.call(this,e))},n.clear=function(){for(;this.numChildren>0;)t.prototype.removeChildAt.call(this,0);this._childList.length=0},n.doSortAvatar=function(){var t=this._childList,e=t.length;t.sort(this.sort);for(var i=null;e--;)i=t[e],this.setChildIndex(i,e)},n.sort=function(t,e){return t.y<e.y?1:0},e}(BaseMapLayer);egret.registerClass(MapAvatarLayer,"MapAvatarLayer");var MapBackGroundLayer=function(t){function e(){t.call(this),this._hasClips={},this._markBmp=null,this._markBmp=new egret.Bitmap,this.addChild(this._markBmp)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setMark=function(t,e,i){var n=e/t.bitmapData.width,r=i/t.bitmapData.height,a=new egret.Matrix;a.scale(n,r),this._markBmp.matrix=a,this._markBmp.texture=t},n.setClipBmd=function(t,e){this._hasClips[t]=e,this.addChild(e)},n.hasClipBmp=function(t){return null!=this._hasClips[t]?!0:!1},n.clearClips=function(t,i){if(!(this.numChildren<e.MAX_CLIP_NUM)){var n=t-MapConfig.MAP_CLIP_IMAGE_WIDTH,r=t+MapConfig.MAP_SCREEN_WIDTH+MapConfig.MAP_CLIP_IMAGE_WIDTH,a=i-MapConfig.MAP_CLIP_IMAGE_HEIGHT,o=i+MapConfig.MAP_SCREEN_HEIGHT+MapConfig.MAP_CLIP_IMAGE_HEIGHT,s=[];for(var h in this._hasClips){var l=this._hasClips[h];(l.x<n||l.x>r||l.y<a||l.y>o)&&s.push(h)}for(var d=0;d<s.length;d++){h=s[d];var l=this._hasClips[h];this._hasClips[h]=null,delete this._hasClips[h],this.contains(l)&&this.removeChild(l),l.texture.dispose(),l=null}}},n.clear=function(){for(var t in this._hasClips){var e=this._hasClips[t];this.contains(e)&&this.removeChild(e),e.texture.dispose(),e=null}this._hasClips={},null!=this._markBmp.texture&&(this._markBmp.texture.dispose(),this._markBmp.texture=null)},e.MAX_CLIP_NUM=60,e}(BaseMapLayer);egret.registerClass(MapBackGroundLayer,"MapBackGroundLayer");var MapEffectLayer=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(BaseMapLayer);egret.registerClass(MapEffectLayer,"MapEffectLayer");var MapContainer=function(t){function e(){t.call(this),this.touchEnabled=!0;var e=new egret.Shape;e.graphics.beginFill(16777215,1),e.graphics.drawRect(0,0,MapConfig.MAP_SCREEN_WIDTH,MapConfig.MAP_SCREEN_HEIGHT),e.graphics.endFill(),this.addChild(e)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.clear=function(){},n.updataPosition=function(t,e){this.x=-1*t,this.y=-1*e},e}(egret.DisplayObjectContainer);egret.registerClass(MapContainer,"MapContainer");var LoaderThread=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,n=e,r=n.prototype;return r.reset=function(){this.isLoad=!1,this.loadInfo=null},r.load=function(t){switch(this.loadInfo=t,this.isLoad=!0,t.loadType){case LoadInfo.GROUP:RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onLoadGroupProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onLoadGroupError,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onLoadGroupComplete,this),RES.loadGroup(t.url);break;case LoadInfo.JSON:RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onLoadConfigComplete,this),RES.addEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onLoadConfigError,this),RES.loadConfig(t.url);break;case LoadInfo.IMG:var e=this.urlLoad;e.dataFormat=egret.URLLoaderDataFormat.TEXTURE,e.addEventListener(egret.Event.COMPLETE,this.onUrlLoadComplete,this),e.addEventListener(egret.ProgressEvent.PROGRESS,this.onTextLoadProgress,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onTextLoadError,this),e.load(new egret.URLRequest(t.url));break;case LoadInfo.TEXT:case LoadInfo.XML:var e=this.urlLoad;e.dataFormat=egret.URLLoaderDataFormat.TEXT,e.addEventListener(egret.Event.COMPLETE,this.onUrlLoadComplete,this),e.addEventListener(egret.ProgressEvent.PROGRESS,this.onTextLoadProgress,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onTextLoadError,this),e.load(new egret.URLRequest(t.url));break;case LoadInfo.BYTE:var e=this.urlLoad;e.dataFormat=egret.URLLoaderDataFormat.BINARY,e.addEventListener(egret.Event.COMPLETE,this.onUrlLoadComplete,this),e.addEventListener(egret.ProgressEvent.PROGRESS,this.onTextLoadProgress,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onTextLoadError,this),e.load(new egret.URLRequest(t.url))}},r.onUrlLoadComplete=function(t){var e=t.target;this.loadInfo.data=e.data,this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))},r.onLoadConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onLoadConfigComplete,this),this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))},r.onLoadGroupComplete=function(t){RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onLoadGroupProgress,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onLoadGroupError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onLoadGroupComplete,this),this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))},r.onLoadGroupProgress=function(t){this.dispatchEventWith(egret.ProgressEvent.PROGRESS,!1,{loaded:t.itemsLoaded,total:t.itemsTotal})},r.onImgLoadProgress=function(t){this.dispatchEventWith(egret.ProgressEvent.PROGRESS,!1,{loaded:t.bytesLoaded,total:t.bytesTotal})},r.onTextLoadProgress=function(t){this.dispatchEventWith(egret.ProgressEvent.PROGRESS,!1,{loaded:t.bytesLoaded,total:t.bytesTotal})},r.onLoadGroupError=function(t){this.loadInfo.errorHandler&&this.loadInfo.errorHandler(this.loadInfo),this.dispatchEventWith(egret.IOErrorEvent.IO_ERROR,!1,{text:"加载"+t.groupName+"资源组时出错"})},r.onLoadConfigError=function(t){this.dispatchEventWith(egret.IOErrorEvent.IO_ERROR,!1,{text:"加载"+this.loadInfo.url+"json配置时出错"})},r.onImgLoadError=function(t){this.dispatchEventWith(egret.IOErrorEvent.IO_ERROR,!1,{text:"加载"+this.loadInfo.url+"出错"})},r.onTextLoadError=function(t){this.dispatchEventWith(egret.IOErrorEvent.IO_ERROR,!1,{text:"加载"+this.loadInfo.url+"出错"})},i(r,"urlLoad",function(){return null==this._urlLoad&&(this._urlLoad=new egret.URLLoader),this._urlLoad}),i(r,"imgLoader",function(){return null==this._imgLoad&&(this._imgLoad=new egret.ImageLoader),this._imgLoad}),e}(egret.EventDispatcher);egret.registerClass(LoaderThread,"LoaderThread");var LoadInfo=function(){function t(t,e,i,n,r,a){void 0===i&&(i=null),void 0===n&&(n=0),void 0===r&&(r=null),void 0===a&&(a=null),this.createTime=0,this.url=t,this.completeHandler=e,this.info=i,this.priority=n,this.progressHandler=r,this.errorHandler=a,this.createTime=egret.getTimer()}var e=(__define,t);e.prototype;return t.XML="xml",t.BYTE="byte",t.JSON="json",t.IMG="IMG",t.TEXT="text",t.GROUP="group",t}();egret.registerClass(LoadInfo,"LoadInfo");var LoadManager=function(){function t(){this.waitLoadList=[],this._max_thread=5,this._loadMapByUrl={},this._isGetVersion=!0,this.init()}var e=__define,i=t,n=i.prototype;return e(t,"ins",function(){return null==t._ins&&(t._ins=new t),t._ins}),n.addGroupLoad=function(t,e,i,n,r){void 0===i&&(i=null),void 0===n&&(n=0),void 0===r&&(r=null);var a=new LoadInfo(t,e,i,n,r);a.loadType=LoadInfo.GROUP,this.load(a)},n.addConfigLoad=function(t,e,i,n,r){void 0===i&&(i=null),void 0===n&&(n=0),void 0===r&&(r=null);var a=new LoadInfo(t,e,i,n,r);a.loadType=LoadInfo.JSON},n.addImgLoad=function(t,e,i,n,r){void 0===i&&(i=null),void 0===n&&(n=0),void 0===r&&(r=null);var a=new LoadInfo(t,e,i,n,r);a.loadType=LoadInfo.IMG,this.load(a)},n.addTextLoad=function(t,e,i,n,r){void 0===i&&(i=null),void 0===n&&(n=0),void 0===r&&(r=null);var a=new LoadInfo(t,e,i,n,r);a.loadType=LoadInfo.TEXT,this.load(a)},n.addByteLoad=function(t,e,i,n,r){void 0===i&&(i=null),void 0===n&&(n=0),void 0===r&&(r=null);var a=new LoadInfo(t,e,i,n,r);a.loadType=LoadInfo.BYTE,this.load(a)},n.clearLoad=function(t){var e=this._loadMapByUrl[t];null!=e&&(e=null,delete this._loadMapByUrl[t])},n.load=function(t){if(null!=t){var e=this._loadMapByUrl[t.url];if(null!=e){for(var i=0;i<e.length;i++){var n=e[i];if(n.completeHandler==t.completeHandler)return}e.push(t)}else e=new Array,e.push(t),this._loadMapByUrl[t.url]=e;var r=this.getFreeLoader();null!=r?r.load(t):(this.waitLoadList.push(t),this.waitLoadList.sort(function(t,e){return t.priority>e.priority?1:(t.priority>e.priority&&t.createTime<e.createTime,0)}))}},n.getFreeLoader=function(){var t;return this._freePools.length>0?t=this._freePools.pop():null},n.init=function(){this._freePools=[],this._taskLoads=[];for(var t,e=0;e<this._max_thread;e++)t=new LoaderThread,t.addEventListener(egret.Event.COMPLETE,this.loadComplete,this),t.addEventListener(egret.ProgressEvent.PROGRESS,this.loadProgress,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.IoErrorHandle,this),this._freePools.push(t),this._taskLoads.push(t)},n.recrycleLoad=function(t){t.loadInfo.url;t.reset(),this._freePools.push(t),this.loadNext()},n.loadNext=function(){function t(t,e){egret.clearTimeout(n),t.load(e)}for(;this.waitLoadList.length>0;){var e=this.getFreeLoader();if(null==e)return;var i=this.waitLoadList.shift(),n=egret.setTimeout(t,this,1,e,i)}},n.loadComplete=function(t){var e=t.target,i=e.loadInfo,n=this._loadMapByUrl[i.url];if(null==n)return void this.recrycleLoad(e);this._loadMapByUrl[i.url]=null,delete this._loadMapByUrl[i.url],this.recrycleLoad(e);for(var r=0;r<n.length;r++){var a=n[r];a.data=i.data,a.content=i.content,a.completeHandler&&a.completeHandler(a)}},n.loadProgress=function(t){var e=t.target;e.loadInfo&&e.loadInfo.progressHandler&&e.loadInfo.progressHandler(t.data)},n.IoErrorHandle=function(t){var e=t.target,i=e.loadInfo.url;e.loadInfo&&e.loadInfo.errorHandler&&e.loadInfo.errorHandler(e.loadInfo),this._loadMapByUrl[i]=null,this.recrycleLoad(e),egret.log(t.data)},t}();egret.registerClass(LoadManager,"LoadManager");var LoadPriorityEnum=function(){function t(){}var e=(__define,t);e.prototype;return t.SOUND_PROPITY=15,t.IMAGE_PRIORITY=5,t.MAPCLIP_PRIORITY=1,t.MAPCONFIG_PRIORITY=10,t.EFFECT_PRIORITY=0,t.AVATAR_PRIORITY=2,t.MY_AVATAR_PRIORITY=9,t}();egret.registerClass(LoadPriorityEnum,"LoadPriorityEnum");var CustomMoviClip=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setRes=function(t,e,i){this._resData=t,this._mcTexture=e,this._mcName=i,this._mcBitmap&&(this._mcBitmap.count(!1),this._mcBitmap=null),this.createMc()},n.startLoad=function(t,e,i){void 0===i&&(i=0),this._url==t&&this.isPlaying||(this._mcBitmap&&(this._mcBitmap.count(!1),this._mcBitmap=null),this._url=t,App.ins.configManager.getConfig(t+".json",this.onLoadTxtComplete,this,i),App.ins.resManager.getImageRes(t+".png",this.onLoadImgComplete,this,i))},n.onLoadTxtComplete=function(t){var e=t.data;e._resData=JSON.parse(t.cfg),e.createMc()},n.onLoadImgComplete=function(t){var e=t.data;e._mcBitmap=t.bmd,t.bmd.count(!0),e._mcTexture=t.bmd.texture,e.createMc()},n.createMc=function(){var t=this;if(null!=t._resData&&null!=t._mcTexture&&null!=t._mcTexture.bitmapData){var e=new egret.MovieClipDataFactory(this._resData,this._mcTexture);t.movieClipData=e.generateMovieClipData(t._mcName),t.play(-1),this.dispatchEvent(new egret.Event(EventName.MOVIE_CREATE_SUCCESS))}},n.dispos=function(){this.stop(),this._resData=null,null!=this._mcBitmap&&(this._mcBitmap.count(!1),this._mcBitmap=null),this._mcTexture=null,this.parent&&this.parent.removeChild(this)},e}(egret.MovieClip);egret.registerClass(CustomMoviClip,"CustomMoviClip");var Avatar=function(t){function e(){t.call(this),this._newDir=0,this.bodyHeight=0;var e=new CustomMoviClip;this._bodyMc=e,this._bodyMc.addEventListener(EventName.MOVIE_CREATE_SUCCESS,this.createBodyComplete,this),this.addChild(e)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setAvatarData=function(t){this._roleData=t,this.upDataAct()},n.upDataAct=function(){var t=this._roleData.dir,i=this._roleData.state;this._newDir=this.getFiveDir(t,this._bodyMc);var n=StringUtil.substitute(e.ROLEKEY,this._roleData.dress,this._roleData.sex,this._newDir,i),r=StringUtil.substitute(e.roleUrl,this._roleData.sex,n);this._bodyMc.startLoad(r,n,LoadPriorityEnum.AVATAR_PRIORITY),this.checkWeapon()},n.createBodyComplete=function(t){var e=this;e.bodyHeight<e._bodyMc.height&&(e.bodyHeight=e._bodyMc.height,e.dispatchEvent(new egret.Event(SceneEventName.UPDATA_ROLE_SIZE,!1)))},n.checkWeapon=function(){if(this._roleData.type==RoleType.TYPE_PLAYER){null==this._weaponMc&&(this._weaponMc=new CustomMoviClip,this.addChild(this._weaponMc));var t=this._roleData.dir,i=this._roleData.state,n=StringUtil.substitute(e.WEAPONKEY,this._newDir,i);this._newDir=this.getFiveDir(t,this._weaponMc);var r=StringUtil.substitute(e.WEAPONURL,n);this._weaponMc.startLoad(r,n,LoadPriorityEnum.AVATAR_PRIORITY)}},n.createWeaponComplete=function(){},n.getFiveDir=function(t,e){var i=t,n=1;switch(t){case SceneType.LEFT_BOTTOME:n=-1,i=SceneType.RIGHT_BOTTOME;break;case SceneType.LEFT:n=-1,i=SceneType.RIGHT;break;case SceneType.LEFT_TOP:n=-1,i=SceneType.RIGHT_TOP}return e.scaleX=n,i},n.stop=function(){this._bodyMc.stop(),this._weaponMc&&this._weaponMc.gotoAndStop(this._bodyMc.currentFrame)},n.gotoAndStop=function(t){this._bodyMc.gotoAndStop(t),this._weaponMc&&this._weaponMc.gotoAndStop(this._bodyMc.currentFrame)},n.gotoAndPlay=function(t,e){void 0===e&&(e=0),this._bodyMc.gotoAndPlay(t,e),this._weaponMc&&this._weaponMc.gotoAndPlay(t,e)},n.clear=function(){this._roleData=null,this._bodyMc.removeEventListener(EventName.MOVIE_CREATE_SUCCESS,this.createBodyComplete,this),this._bodyMc.dispos(),this._bodyMc=null,this._weaponMc&&(this._weaponMc.dispos(),this._weaponMc=null)
},e.roleUrl="resource/art/movie/body/{0}/{1}",e.ROLEKEY="body00{0}_{1}_{2}{3}",e.WEAPONKEY="weapon000_1_{0}{1}",e.WEAPONURL="resource/art/movie/weapon/{0}",e}(egret.DisplayObjectContainer);egret.registerClass(Avatar,"Avatar");var BaseRole=function(t){function e(){t.call(this),this._startPoint=null,this._isMoving=!1,this._onlyKey="",this.runEndFunc=null,e._index++,this._onlyKey="baseRole"+e._index,this._startPoint=new egret.Point(0,0),this._avatar=new Avatar,this.addChild(this._avatar)}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"isMoving",function(){return this._isMoving},function(t){this._isMoving=t,t?LoopManager.addToFrame(this._onlyKey,this.loop,this):LoopManager.removeFromFrame(this._onlyKey)}),i(r,"roleData",function(){return this._roleData}),r.setRoleData=function(t){this._roleData=t,this._avatar.setAvatarData(t)},r.loop=function(t){t._isMoving&&t.move()},r.move=function(){var t=egret.getTimer(),e=(t-this._startTime)/1e3;this.x=Math.floor(this._startPoint.x+this._curSpeedX*e),this.y=Math.floor(this._startPoint.y+this._curSpeedY*e),t>=this._endTime&&(this.x=this._targetPoint.x,this.y=this._targetPoint.y,null!=this._movePaths&&this._movePaths.length>0?this.doNextMove():(this.runEndFunc&&(this.runEndFunc(),this.runEndFunc=null),this.doStandAct()))},r.removePath=function(){this._movePaths&&this._movePaths.length>0&&(this._movePaths.length=0)},r.startMove=function(t,e){void 0===e&&(e=null),this._movePaths=t,0==t.length?this.doStandAct():(this.runEndFunc=e,this.doNextMove())},r.doNextMove=function(){this.isMoving=!0;var t=this._movePaths;if(null!=t&&t.length>0){this._startPoint.x=this.x,this._startPoint.y=this.y,this._targetPoint=t.pop();var e=this._startPoint.x,i=this._startPoint.y,n=this._targetPoint.x,r=this._targetPoint.y,a=egret.Point.distance(this._startPoint,this._targetPoint),o=a/this._roleData.speed;0==o&&(o=.001);var s=this.getDirection(this._targetPoint);this._roleData.dir=s,this._startTime=egret.getTimer(),this._curSpeedX=(n-e)/o,this._curSpeedY=(r-i)/o,this._endTime=this._startTime+Math.floor(1e3*o),this.doRunAct()}},r.stopMove=function(){this.isMoving=!1,this.removePath(),this.doStandAct()},r.doRunAct=function(){this._roleData.state=RoleState.ROLE_RUN,this._avatar.upDataAct()},r.doStandAct=function(){this._targetPoint=null,this._roleData.state=RoleState.ROLE_STAND,this.isMoving=!1,this._avatar.upDataAct()},r.doAttackAct=function(){this._targetPoint=null,this._roleData.state=RoleState.ROLE_ATTACK,this.isMoving=!1,this._avatar.upDataAct()},r.getDirection=function(t){var e=t.x,i=t.y,n=0,r=e-this.x,a=this.y-i;if(0==r&&0==a)return this.roleData.dir;var o=180*Math.atan2(a,r)/Math.PI;return o>=67&&112>o?SceneType.TOP:o>=22&&67>o?SceneType.RIGHT_TOP:o>=-22&&22>o?SceneType.RIGHT:o>=-67&&-22>o?SceneType.RIGHT_BOTTOME:o>=-112&&-67>o?SceneType.BOTTOM:o>=-157&&-112>o?SceneType.LEFT_BOTTOME:-157>o||o>=157?SceneType.LEFT:o>=112&&157>o?SceneType.LEFT_TOP:n},r.remove=function(){this.parent&&this.parent.removeChild(this),this.isMoving=!1,this._roleData=null,this._avatar.clear(),this.runEndFunc=null,this.removePath()},e._index=0,e}(egret.DisplayObjectContainer);egret.registerClass(BaseRole,"BaseRole");var BaseRoleData=function(){function t(){this.level=15,this.speed=160}var e=(__define,t);e.prototype;return t}();egret.registerClass(BaseRoleData,"BaseRoleData");var RoleState=function(){function t(){}var e=(__define,t);e.prototype;return t.ROLE_STAND="s",t.ROLE_RUN="r",t.ROLE_ATTACK="a",t.ROLE_C="c",t.STATES={0:t.ROLE_STAND,1:t.ROLE_RUN,2:t.ROLE_ATTACK,3:t.ROLE_C},t}();egret.registerClass(RoleState,"RoleState");var RoleType=function(){function t(){}var e=(__define,t);e.prototype;return t.TYPE_PLAYER=1,t.TYPE_MONSTER=2,t.TYPE_NPC=3,t}();egret.registerClass(RoleType,"RoleType");var SceneType=function(){function t(){}var e=(__define,t);e.prototype;return t.TOP=0,t.RIGHT_TOP=1,t.RIGHT=2,t.RIGHT_BOTTOME=3,t.BOTTOM=4,t.LEFT_BOTTOME=5,t.LEFT=6,t.LEFT_TOP=7,t}();egret.registerClass(SceneType,"SceneType");var LoopManager=function(){function t(){}var e=__define,i=t;i.prototype;return t.init=function(e){if(0==t._isInited){t.frameLoopDic={},t.timeoutDic={},t.timeLoopDic={},t.secondLoopDic={},t.stage=e,t.stage.addEventListener(egret.Event.ENTER_FRAME,t.frameLoop,null),t._isInited=!0,t._currentTime=egret.getTimer();var i=new egret.Timer(1e3);i.addEventListener(egret.TimerEvent.TIMER,t.onTimerIntvel,t),i.start()}},t.frameLoop=function(e){t.doFrameRate();var i,n=t.frameLoopDic;for(var r in n)if(i=t.frameLoopDic[r],null!=i){var a=i.handler;a(i.param)}t._curTime-t._timeTime>=100&&(t._timeTime=t._curTime,t.timerLoop())},t.timerLoop=function(){var e;for(var i in t.timeoutDic)e=t.timeoutDic[i],t._curTime-e.startTime>=e.count&&(e.handler.apply(null,e.arg),t.timeoutDic[e.key]=null,delete t.timeoutDic[e.key]);for(i in t.timeLoopDic)e=t.timeLoopDic[i],t._curTime-e.startTime>=e.count&&(e.startTime=t._curTime,e.handler.apply(null,e.arg))},t.onTimerIntvel=function(e){var i;for(var n in t.secondLoopDic)i=t.secondLoopDic[n],i.handler(i.param)},t.addToFrame=function(e,i,n){void 0===n&&(n=null);var r=t.frameLoopDic;if(null==r[e]){var a={handler:i,param:n};t.frameLoopDic[e]=a}},t.removeFromFrame=function(e){t.frameLoopDic[e]&&(t.frameLoopDic[e]=null,delete t.frameLoopDic[e])},t.hasFrame=function(e){return t.frameLoopDic[e]?!0:!1},t.addToSecond=function(e,i,n){if(null==t.secondLoopDic[e]){var r={handler:i,param:n};t.frameLoopDic[e]=r}},t.removeFromSceond=function(e){t.secondLoopDic[e]&&(t.secondLoopDic[e]=null,delete t.secondLoopDic[e])},t.hasScendKey=function(e){return t.secondLoopDic[e]?!0:!1},t.setTimeout=function(e,i,n){if(void 0===n&&(n=null),0==i)return e.apply(null,n),0;t.delayIDKey++;var r={key:t.delayIDKey,startTime:egret.getTimer(),count:i,handler:e,arg:n};return null==t.timeoutDic[t.delayIDKey]&&(t.timeoutDic[t.delayIDKey]=r),t.delayIDKey},t.clearTimeout=function(e){t.timeoutDic[e]&&(t.timeoutDic[e]=null,delete t.timeoutDic[e])},t.hasTimeout=function(e){return null!=t.timeoutDic[e]},t.setInterval=function(e,i,n){if(void 0===n&&(n=null),0==i)return e.apply(null,n),0;t.delayIDKey++;var r={key:t.delayIDKey,startTime:egret.getTimer(),count:i,handler:e,arg:n};return null==t.timeLoopDic[t.delayIDKey]&&(t.timeLoopDic[t.delayIDKey]=r),t.delayIDKey},t.clearInterval=function(e){t.timeLoopDic[e]&&(t.timeLoopDic[e]=null,delete t.timeLoopDic[e])},t.hasInterval=function(e){return null!=t.timeLoopDic[e]},e(t,"realRate",function(){return t._realFrameRate}),e(t,"frameHold",function(){return t._frameHold}),t.doFrameRate=function(){t._currentFrame++,t._curTime=egret.getTimer(),t._currentTime=t._curTime,t._frameHold=t._curTime-t.lastTime,t.lastTime=t._curTime,t.secFrames++,t._curTime-t.frameTime>=1e3&&(t._realFrameRate=t.secFrames,t.frameTime=t._curTime,t.secFrames=0)},e(t,"currentFrame",function(){return t._currentFrame}),e(t,"currentTime",function(){return t._currentTime}),t.frameToTime=function(e){return e*(1e3/t.stage.frameRate)},t.timeToFrame=function(e){return e/1e3*t.stage.frameRate},t._isInited=!1,t._currentFrame=0,t._currentTime=0,t._curTime=0,t.lastTime=0,t._realFrameRate=30,t._timeTime=0,t._secondTime=0,t.delayIDKey=0,t._frameHold=30,t.secFrames=0,t.frameTime=0,t}();egret.registerClass(LoopManager,"LoopManager");var UiWindow=function(t){function e(){t.call(this),this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createComplete,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createComplete=function(t){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closePanel,this)},n.closePanel=function(t){this.parent&&(this.parent.isPop=!1);new eui.Panel},n.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},n.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);egret.registerClass(UiWindow,"UiWindow",["eui.UIComponent"]);var CustomButton=function(t){function e(){t.call(this),this._btnImg=null,this.touchEnabled=!0,this._btnImg=new CustomImage,this.addChild(this._btnImg),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_ROLL_OUT,this.onTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchHandler,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setUrl=function(t){this._btnImg.url=t},n.setTexture=function(t){this._btnImg.texture=t},n.onTouchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._btnImg.x=1,this._btnImg.y=1;break;case egret.TouchEvent.TOUCH_TAP:case egret.TouchEvent.TOUCH_ROLL_OUT:this._btnImg.x=0,this._btnImg.y=0}},e}(egret.Sprite);egret.registerClass(CustomButton,"CustomButton");var CustomImage=function(t){function e(){t.call(this),this._url="",this._cbmd=null}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"url",void 0,function(t){this._url!=t&&App.ins.resManager.getImageRes(t,this.oLoadComplete,this,LoadPriorityEnum.IMAGE_PRIORITY)}),r.oLoadComplete=function(t){var i=t.data;i._cbmd=t.bmd,i._cbmd.count(!0),i.texture=t.bmd.texture,i.dispatchEvent(new egret.Event(e.LOAD_IMG_COMPLETE))},r.dispos=function(){this.parent&&this.parent.removeChild(this),this.texture&&(this.texture.dispose(),this.texture=null),this._cbmd&&(this._cbmd.count(!1),this._cbmd=null)},e.LOAD_IMG_COMPLETE="load_img_complete",e}(egret.Bitmap);egret.registerClass(CustomImage,"CustomImage");var CustomNumImg=function(t){function e(e){t.call(this),this.resKey="{0}{1}_png",this.touchEnabled=!1,this._head=e}__extends(e,t);var i=(__define,e),n=i.prototype;return n.upDataNum=function(t){this.clear();for(var e=0,i=0;i<t.length;i++){var n=t.charAt(i);n=StringUtil.substitute(this.resKey,this._head,n);var r=new egret.Bitmap(RES.getRes(n));r.x=e,e+=r.width,this.addChild(r)}},n.clear=function(){for(;this.numChildren>0;){var t=this.removeChildAt(0);t.texture=null}},e}(egret.DisplayObjectContainer);egret.registerClass(CustomNumImg,"CustomNumImg");var CustomToggleGroup=function(t){function e(){t.call(this),this._toggleArr=null,this._selectTab=null,this._toggleArr=[]}__extends(e,t);var i=__define,n=e,r=n.prototype;return r.setToggleBtn=function(t){-1==this._toggleArr.indexOf(t)&&(this._toggleArr.push(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTabHandler,this))},i(r,"selectTab",function(){return this._selectTab},function(t){this._selectTab!=t&&(this._selectTab&&(this._selectTab.selected=!1,this._selectTab.enabled=!0),this._selectTab=t,this._selectTab.enabled=!1,this._selectTab.selected=!0,this.dispatchEvent(new egret.Event(egret.Event.CHANGE)))}),r.onTouchTabHandler=function(t){this._selectTab!=t.currentTarget&&(this.selectTab=t.currentTarget)},e}(egret.EventDispatcher);egret.registerClass(CustomToggleGroup,"CustomToggleGroup");var UiManager=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(){t._container=App.ins.layer.windowLayer},t.show=function(e){t._container.addChild(e),t.setPanelPosition(e)},t.hide=function(e){t._container.contains(e)&&t._container.removeChild(e)},t.setPanelPosition=function(t){if(null!=t.parent){var e=App.ins.stage.stageWidth,i=App.ins.stage.stageHeight;t.x=Math.floor((e-t.panelW)/2),t.y=Math.floor((i-t.panelH)/2)}},t._container=null,t}();egret.registerClass(UiManager,"UiManager");var BaseView=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0),t.call(this),this._isPop=!1,this._panelW=e,this._panelH=i,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.onCreateComplete,this)}__extends(e,t);var i=__define,n=e,r=n.prototype;return r.onCreateComplete=function(t){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.onCreateComplete,this)},r.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},r.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i(r,"isPop",void 0,function(t){this._isPop!=t&&(this._isPop=t,t?UiManager.show(this):UiManager.hide(this))}),i(r,"panelW",function(){return 0==this._panelW&&(this._panelW=this.width),this._panelW}),i(r,"panelH",function(){return 0==this._panelH&&(this._panelH=this.height),this._panelH}),e}(eui.Component);egret.registerClass(BaseView,"BaseView",["eui.UIComponent"]);var GlobUrl=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(GlobUrl,"GlobUrl");var Message=function(){function t(){}var e=(__define,t);e.prototype;return t.show=function(e){null==t.layer&&(t.layer=App.ins.layer.msgLayer);var i=null,n=t.items;n.length>=t.maxCount&&(i=n.shift(),i.dispos()),i=MessageItem.getItem(),i.setMsg(e);for(var r=i.height,a=n.length-1;a>=0;a--){var o=n[a];o.upTo(r),r=o.height}n.push(i),i.alpha=1,i.x=(App.ins.stage.stageWidth-i.width)/2,i.y=t.fixedY,i.addToContainer()},t.removeItem=function(e){var i=t.items.indexOf(e);-1!=i&&t.items.splice(i,1)},t.layer=null,t.maxCount=3,t.items=[],t.fixedY=400,t}();egret.registerClass(Message,"Message");var MessageItem=function(t){function e(){t.call(this),this._removeKey=0,this._count=0,this._msgTxt=null,this._msgBackImg=null,null==e._pools&&(e._pools=new Array),this._msgBackImg=new eui.Image,this._msgBackImg.texture=RES.getRes("zjm_09"),this._msgBackImg.scale9Grid=new egret.Rectangle(40,7,400,100),this.addChild(this._msgBackImg),this._msgTxt=new egret.TextField,this._msgTxt.x=6,this._msgTxt.y=6,this._msgTxt.textColor=16776960,this._msgTxt.stroke=2,this._msgTxt.strokeColor=0,this._msgTxt.size=20,this._msgTxt.bold=!0,this._msgTxt.wordWrap=!1,this._msgTxt.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this._msgTxt)}__extends(e,t);var i=__define,n=e,r=n.prototype;return r.upTo=function(t){var e=egret.Tween.get(this);e.to({y:this.y-t},200)},r.setMsg=function(t){this._msgTxt.textFlow=HtmlUtil.getHtmlStr(t),this._msgBackImg.width=this._msgTxt.textWidth+3+12,this._msgBackImg.height=this._msgTxt.textHeight+3+12},i(r,"width",function(){return this._msgBackImg.width}),i(r,"height",function(){return this._msgBackImg.height}),r.addToContainer=function(){function t(){this._removeKey=egret.setTimeout(i,this,e.defaultStayTime)}function i(){function t(t){Message.removeItem(r),r.dispos()}var e=egret.Tween.get(r);e.to({y:r.y-10,alpha:.1},500),e.call(t,r)}this.clearKey();var n=Message.layer;n.addChild(this),this.alpha=0,this.y=200;var r=this,a=egret.Tween.get(this);a.to({alpha:1},300).call(t,this)},r.clearKey=function(){0!=this._removeKey&&(egret.clearTimeout(this._removeKey),this._removeKey=0)},r.dispos=function(){egret.Tween.removeTweens(this),this.parent&&this.parent.removeChild(this),e._pools.push(this),this.clearKey()},e.getItem=function(){return e._pools.length>0?e._pools.shift():new e},e._pools=new Array,e.defaultStayTime=1500,e.upMoveY=30,e}(egret.DisplayObjectContainer);egret.registerClass(MessageItem,"MessageItem");var BaseModule=function(){function t(){this._dispatch=null,this._dispatch=GameDispatcher.ins}var e=__define,i=t,n=i.prototype;return n.startup=function(){throw new Error("需要被重写")},n.openView=function(){},e(n,"moduleName",function(){return"未被重写的模块名称"}),n.initListeners=function(){throw new Error("需要被重写")},n.addSocketListener=function(t,e){},n.removeSocketListener=function(t,e){},n.sendSocketMessage=function(t){},n.dispatch=function(t,e){void 0===e&&(e=null),this._dispatch.dispatchEventWith(t,e)},n.addModuleListener=function(t,e){this._dispatch.addEventListener(t,e,this)},n.removeModuleListener=function(t,e){},n.dispose=function(){},t}();egret.registerClass(BaseModule,"BaseModule");var ChatModule=function(t){function e(){t.call(this),this._chatView=null}__extends(e,t);var i=(__define,e),n=i.prototype;return n.startup=function(){this.initListeners()},n.initListeners=function(){},n.openView=function(){null==this._chatView&&(this._chatView=new ChatView),this._chatView.isPop=!0},e}(BaseModule);egret.registerClass(ChatModule,"ChatModule");var ChatView=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onCreateComplete=function(e){t.prototype.onCreateComplete.call(this,e),this.textInput.text="输入内容",this.sendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSendHandler,this)},n.onSendHandler=function(t){Message.show(this.textInput.text)},n.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},n.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(BaseView);egret.registerClass(ChatView,"ChatView",["eui.UIComponent"]);var CreateRoleView=function(t){function e(e){t.call(this),this.tab1=null,this.tab2=null,this.tab3=null,this.tab4=null,this.tab5=null,this.tab6=null,this.jobImg=null,this.jobDesTxt=null,this.nameTxt=null,this.starBtn=null,this.randomBtn=null,this._toggleGroup=null,this._roleData=null,this._module=e}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onCreateComplete=function(i){t.prototype.onCreateComplete.call(this,i);var n=new CustomToggleGroup;n.addEventListener(egret.Event.CHANGE,this.onToggleChangeHandelr,this),this._toggleGroup=n,n.setToggleBtn(this.tab1),n.setToggleBtn(this.tab2),n.setToggleBtn(this.tab3),n.setToggleBtn(this.tab4),n.setToggleBtn(this.tab5),n.setToggleBtn(this.tab6),this._roleData=new PlayerInfoData,n.selectTab=this.tab1;var r=e.names[Math.floor(Math.random()*(e.names.length-1))];this.nameTxt.text=r,this.nameTxt.addEventListener(egret.Event.CHANGE,this.onNameChangeHandler,this),this.starBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartHandler,this),this.randomBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRandomHandler,this)},n.onStartHandler=function(t){return""==this.nameTxt.text?void Message.show("请创建一个名字"):(this._roleData.name=this.nameTxt.text,void this._module.createRole(this._roleData))},n.onRandomHandler=function(t){var i=e.names[Math.floor(Math.random()*(e.names.length-1))];this.nameTxt.text=i},n.onNameChangeHandler=function(t){var e=t.target;e.text.length>8&&(e.text=e.text.slice(0,8))},n.onToggleChangeHandelr=function(t){var i=t.target,n=i.selectTab,r=0,a=0,o="";switch(n){case this.tab1:o="cjsc_06",a=0,r=1;break;case this.tab2:o="cjsc_06",a=1,r=1;break;case this.tab3:r=2,o="cjsc_07",a=0;break;case this.tab4:o="cjsc_07",a=1,r=2;break;case this.tab5:o="cjsc_08",a=0,r=3;break;case this.tab6:o="cjsc_08",a=1,r=3}this.jobImg.source=o,this.jobDesTxt.text=e.desObj[r],this._roleData.job=r,this._roleData.sex=a},n.dispos=function(){this.isPop=!1,this._toggleGroup.removeEventListener(egret.Event.CHANGE,this.onToggleChangeHandelr,this),this.nameTxt.removeEventListener(egret.Event.CHANGE,this.onNameChangeHandler,this),this.starBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartHandler,this),this.randomBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRandomHandler,this),RES.destroyRes("cjjs")},n.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},n.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.names=["2呵","2v","卖萌的婷婷","榔头","傻z","逗比盖","大表哥","土豪炳","逗比摸头","流星"],e.desObj={1:"近战物理职业，通过暴力摧毁敌人",2:"魔法职业，拥有最强大的远程群体攻击",3:"兼顾远程输出和辅助的职业，还能召唤宠物攻击"},e}(BaseView);egret.registerClass(CreateRoleView,"CreateRoleView",["eui.UIComponent"]);var MainModule=function(t){function e(){t.call(this),this._createRole=null,this._mainView=null}__extends(e,t);var i=__define,n=e,r=n.prototype;return r.startup=function(){null==this._createRole&&(this._createRole=new CreateRoleView(this),this._createRole.isPop=!0),this.initListeners()},r.initListeners=function(){},r.createRole=function(t){this.dispatch(EventName.CREATE_ROLE_SUCCESS,t),this._createRole.dispos(),this._createRole=null,this.initMainView(t)},r.initMainView=function(t){null==this._mainView&&(this._mainView=new MainView(this),App.ins.layer.mainLayer.addChild(this._mainView),this._mainView.setRoleData(t))},i(r,"moduleName",function(){return"主界面"}),e}(BaseModule);egret.registerClass(MainModule,"MainModule");var MainView=function(t){function e(e){t.call(this),this.testBtn=null,this._roleData=null,this._welcomView=null,this._module=e,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.onCreateComplete,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onCreateComplete=function(t){this._viplvlImg=new CustomNumImg("5"),this._viplvlImg.x=150,this._viplvlImg.y=98,this.addChild(this._viplvlImg),this._fightNumImg=new CustomNumImg("4"),this._fightNumImg.x=165,this._fightNumImg.y=52,this.addChild(this._fightNumImg),this.addEvent(),this._welcomView=new WelcomView,this._welcomView.isPop=!0},n.setRoleData=function(t){this._roleData=t,this.nameTxt.text=t.name,this.lvlTxt.text=t.level+"级",this.yuanbaoTxt.text=t.yuanbao.toString(),this.yinbiTxt.text=t.yinbi.toString(),this.headImg.source="uihead"+t.job+t.sex+"_png",this._viplvlImg.upDataNum(t.vipLvl.toString()),this._fightNumImg.upDataNum(t.fightNum.toString())},n.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},n.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.addEvent=function(){this.testBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTestHandler,this)},n.onTestHandler=function(t){App.ins.moduleManager.openModule(ModuleIdStatic.CHAT_MODULE)},e}(eui.Component);egret.registerClass(MainView,"MainView",["eui.UIComponent"]);var WelcomView=function(t){function e(){t.call(this),this._conatiner=null,this._conatiner=App.ins.layer.moduleLayer,this._backImg=new CustomImage,this._backImg.url=e.backUrl,this.addChild(this._backImg),this._startBtn=new CustomButton,this._startBtn.x=168,this._startBtn.y=430,this._startBtn.setTexture(RES.getRes("welcome_02")),this.addChild(this._startBtn),this._startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTab,this)}__extends(e,t);var i=__define,n=e,r=n.prototype;return r.onTouchTab=function(t){this.isPop=!1},i(r,"isPop",void 0,function(t){t?(this.y=100,this._conatiner.addChild(this),this._conatiner.graphics.clear(),this._conatiner.graphics.beginFill(0,.6),this._conatiner.graphics.drawRect(0,0,App.ins.stage.stageWidth,App.ins.stage.stageHeight),this._conatiner.graphics.endFill(),this._conatiner.touchEnabled=!0):(this._conatiner.graphics.clear(),this._conatiner.touchEnabled=!1,this._conatiner.contains(this)&&this._conatiner.removeChild(this),this._backImg.dispos())}),e.backUrl="resource/art/img/welcome/welcome_01.png",e}(egret.Sprite);egret.registerClass(WelcomView,"WelcomView");var PlayerInfoData=function(t){function e(){t.call(this),this.yuanbao=0,this.yinbi=1e4,this.vipLvl=0,this.fightNum=1e3}__extends(e,t);var i=(__define,e);i.prototype;return e}(BaseRoleData);egret.registerClass(PlayerInfoData,"PlayerInfoData");var Monster=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setRoleData=function(e){e.type=RoleType.TYPE_MONSTER,t.prototype.setRoleData.call(this,e)},e}(BaseRole);egret.registerClass(Monster,"Monster");var Player=function(t){function e(){t.call(this),this._nameTxt=null,this.isSelf=!1,this.touchEnabled=!0;var e=new egret.TextField;e.textAlign=egret.HorizontalAlign.CENTER,e.size=14,e.filters=[new egret.GlowFilter(0,1,3,3,2,1)],e.text="12324",this._nameTxt=e,this.addChild(e),this._avatar.addEventListener(SceneEventName.UPDATA_ROLE_SIZE,this.refreshBodySize,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refreshBodySize=function(t){this._nameTxt.text=this.roleData.name,this._nameTxt.width=this._nameTxt.textWidth+3,this._nameTxt.x=-this._nameTxt.width/2,this._nameTxt.y=-this._avatar.bodyHeight-5},n.move=function(){if(null!=this._targetPoint){var t=egret.getTimer(),e=(t-this._startTime)/1e3;this.x=Math.floor(this._startPoint.x+this._curSpeedX*e),this.y=Math.floor(this._startPoint.y+this._curSpeedY*e),t>=this._endTime&&(this.x=this._targetPoint.x,this.y=this._targetPoint.y,null!=this._movePaths&&this._movePaths.length>0?this.doNextMove():(this.runEndFunc&&(this.runEndFunc(),this.runEndFunc=null),this.doStandAct())),this.isSelf&&GameDispatcher.ins.dispatchEventWith(SceneEventName.MY_ROLE_CHANGE_POSITION,{x:this.x,y:this.y})}},n.setRoleData=function(e){e.type=RoleType.TYPE_PLAYER,t.prototype.setRoleData.call(this,e)},n.remove=function(){this._avatar.removeEventListener(SceneEventName.UPDATA_ROLE_SIZE,this.refreshBodySize,this),this._nameTxt.filters=null,this.removeChild(this._nameTxt),this._nameTxt=null,t.prototype.remove.call(this)},e}(BaseRole);egret.registerClass(Player,"Player");var MapModule=function(t){function e(){t.call(this),this._sceneManager=null}__extends(e,t);var i=__define,n=e,r=n.prototype;return r.startup=function(){this._sceneManager=SceneManager.ins,this._mapView=new MapViewMediator(App.ins.layer.sceneLayer),this._sceneManager.mapViewMediator=this._mapView,this.initListeners()},r.initListeners=function(){this.addModuleListener(EventName.CREATE_ROLE_SUCCESS,this.onCreateRoleHandler)},r.onCreateRoleHandler=function(t){this._sceneManager.createMyRole(t.data),this._sceneManager.initMap()},r.openView=function(){},i(r,"moduleName",function(){return"地图模块"}),e}(BaseModule);egret.registerClass(MapModule,"MapModule");var SceneManager=function(){function t(){this.mapViewMediator=null,this._myRole=null,this._loadProxy=null,this._sceneProxy=null,this.myRoleData=null,this._isMapClick=!1,this._dispatcher=null,this._roleMap={},this._loadProxy=new MapLoadProxy,this._sceneProxy=new MapSceneProxy,this._dispatcher=GameDispatcher.ins,this._dispatcher.addEventListener(SceneEventName.MY_ROLE_CHANGE_POSITION,this.onChangeMyRolePoint,this)}var e=__define,i=t,n=i.prototype;return e(t,"ins",function(){return null==t._ins&&(t._ins=new t),t._ins}),n.createMyRole=function(t){this._myRole=this.mapViewMediator.createMyRole(t),this.myRoleData=this._myRole.roleData},n.initMap=function(){this.clear(),LoopManager.addToFrame("sceneManager",this.onLoopHandler),this._loadProxy.setBgView(this.mapViewMediator.backLayer),this._loadProxy.setMapId(2),this._loadProxy.addEventListener(SceneEventName.GAMEMAP_DATA_LOAD_COMPLETE,this.mapLoadComplete,this)},e(n,"myRole",function(){return this._myRole}),n.mapLoadComplete=function(t){this.mapData=t.data,this.mapViewMediator.avatarLayer.addChild(this.myRole),null==this._transLine&&(this._transLine=new AcorrsLineGrid(t.data)),this._transLine.reset(t.data),this.resetMapView()},n.resetMapView=function(){this._isMapClick=!0;var t=this.myRoleData.nodeX*MapConfig.MAP_NODE_WIDTH*.5,e=this.myRoleData.nodeY*MapConfig.MAP_NODE_HEIGHT*.5;this._myRole.x=t,this._myRole.y=e,this._sceneProxy.upMapAreaRect(this.mapData.mapWidth,this.mapData.mapHeight),this._sceneProxy.upSceneRect(App.ins.stage.stageWidth,App.ins.stage.stageHeight),this._sceneProxy.setRolePoint(t,e),this._sceneProxy.moveScene(),this.mapViewMediator.map.updataPosition(this._sceneProxy.sceneRect.x,this._sceneProxy.sceneRect.y),this.randomRole()},n.onChangeMyRolePoint=function(t){var e=this._myRole.x,i=this._myRole.y;this._sceneProxy.setRolePoint(e,i,!0),this.mapViewMediator.map.updataPosition(this._sceneProxy.sceneRect.x,this._sceneProxy.sceneRect.y)},n.ClickMap=function(t,e){if(null!=this._myRole){this._isMapClick=!0;var i=this.searchAstar(t,e,this.myRoleData.nodeX,this.myRoleData.nodeY);i&&i.length>0&&this._myRole.startMove(i)}},n.onLoopHandler=function(){var e=LoopManager.currentFrame;e%5==0&&(t.ins.checkMapClips(),e%6==0&&t.ins.mapViewMediator.avatarLayer.doSortAvatar())},n.checkMapClips=function(){function e(){var e=t.ins._sceneProxy.clips;t.ins._loadProxy.loadClips(e),t.ins.mapViewMediator.backLayer.clearClips(t.ins._sceneProxy.sceneRect.x,t.ins._sceneProxy.sceneRect.y)}this._isMapClick&&(this._isMapClick=!1,e()),null!=this.mapData&&this._myRole.isMoving&&e()},n.searchAstar=function(t,e,i,n,r){void 0===r&&(r=0);var a=t%MapConfig.MAP_NODE_WIDTH,o=e%MapConfig.MAP_NODE_HEIGHT,s=this.mapData.getNodeByXY(t,e),h=this.mapData.getNode(i,n),l=[];if(null==h||null==s)return null;if(h==s)return l.push(this.getPoint(a,o,s)),l;if(s=this.getEnd(s),!s.walkAble)for(var d=0,u=0;s&&!s.walkAble&&s!=h;)d=0,u=0,h.x>s.x?d=1:h.x<s.x&&(d=-1),h.y>s.y?u=1:h.y<s.y&&(u=-1),s=this.mapData.getNode(s.x+d,s.y+u);this.mapData.startNode=h,this.mapData.endNode=s;var c=Astart.findPath(this.mapData);if(null==c||c.length<=0)return null;var _;c=Astart.profect(c),c=this._transLine.getPsnode(c),c.pop();for(var p=0,g=c.length;g>p;p++)_=c[p],_==s?l.push(this.getPoint(a,o,_)):l.push(this.getPoint(0,0,_));return l},n.getPoint=function(t,e,i){var n;return null==n&&(n=new egret.Point),n.setTo(i.x*MapConfig.MAP_NODE_WIDTH+t,i.y*MapConfig.MAP_NODE_HEIGHT+e),n},n.getEnd=function(t){if(t.walkAble)return t;var e=null,i=null,n=-1,r=-1;for(n=-1;2>n;n++)for(r=-1;2>r;r++)if(e=this.mapData.getNode(t.x+n,t.y+r),e&&e.walkAble){i=e;break}return i||t},n.removeRoleByid=function(t){var e=this._roleMap[t];e&&(e.remove(),delete this._roleMap[t])},n.randomRole=function(){for(var t=0;100>t;t++){var e=this.mapViewMediator.createOtherPlayer();e.roleData.onlyid=t+1,e.roleData.name="士兵"+(t+1),this.mapViewMediator.avatarLayer.addChild(e),this._roleMap[t+1]=e}},n.clear=function(){this.mapViewMediator.clear(),this._loadProxy.clear();for(var t in this._roleMap){var e=this._roleMap[t];e.remove()}this._roleMap={}},t._ins=null,t.roleIndex=0,t}();egret.registerClass(SceneManager,"SceneManager");var MapViewMediator=function(){function t(t){this._mapBackLayer=null,this._mapAvatarLayer=null,this._mapEffectLayer=null,this._parent=t,this.init()}var e=__define,i=t,n=i.prototype;return n.init=function(){this._map=new MapContainer,this._parent.addChild(this._map),this._mapBackLayer=new MapBackGroundLayer,this._mapEffectLayer=new MapEffectLayer,this._mapAvatarLayer=new MapAvatarLayer,this._map.addChild(this._mapBackLayer),this._map.addChild(this._mapEffectLayer),this._map.addChild(this._mapAvatarLayer),this._mapAvatarLayer.init(),this._map.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMapClick,this)},n.onMapClick=function(t){SceneManager.ins.ClickMap(t.localX,t.localY)},e(n,"map",function(){return this._map}),e(n,"backLayer",function(){return this._mapBackLayer}),e(n,"effectLayer",function(){return this._mapEffectLayer}),e(n,"avatarLayer",function(){return this._mapAvatarLayer}),n.createMyRole=function(t){var e=new Player;e.isSelf=!0,t.dir=4,t.dress=0,t.level=Math.floor(80*Math.random()+10);var i=Math.floor(3.9*Math.random()),n=RoleState.STATES;n[i];return t.state=RoleState.ROLE_STAND,t.nodeX=Math.floor(22*Math.random())+22,t.nodeY=Math.floor(22*Math.random())+22,e.setRoleData(t),e},n.createOtherPlayer=function(){var t=new Player,e=new PlayerInfoData;t.isSelf=!1,e.dir=4,e.sex=Math.floor(1*Math.random()),e.dress=Math.floor(3*Math.random()),e.level=Math.floor(80*Math.random()+10);var i=Math.floor(3.9*Math.random()),n=RoleState.STATES,r=n[i];return e.state=r,e.nodeX=Math.floor(43*Math.random())+4,e.nodeY=Math.floor(43*Math.random())+4,t.setRoleData(e),t.x=e.nodeX*MapConfig.MAP_NODE_WIDTH+.5*MapConfig.MAP_NODE_WIDTH,t.y=e.nodeY*MapConfig.MAP_NODE_HEIGHT+.5*MapConfig.MAP_NODE_HEIGHT,t},n.clear=function(){this._mapBackLayer.clear(),this._mapEffectLayer.clear(),this._mapAvatarLayer.clear()},t}();egret.registerClass(MapViewMediator,"MapViewMediator");var ModuleManager=function(){function t(){this.setModules()}var e=(__define,t),i=e.prototype;return i.startModule=function(){for(var t in this._modules)this._modules[t].startup()},i.setModules=function(){this._modules={},this._modules[ModuleIdStatic.MAP_MODULE]=new MapModule,this._modules[ModuleIdStatic.MAIN_MODULE]=new MainModule,this._modules[ModuleIdStatic.CHAT_MODULE]=new ChatModule},i.openModule=function(t,e){void 0===e&&(e=0);var i=this._modules[t];i.openView()},t}();egret.registerClass(ModuleManager,"ModuleManager");var EventName=function(){function t(){}var e=(__define,t);e.prototype;return t.OPEN_MODULE_VIEW="open_module_view",t.CREATE_ROLE_SUCCESS="create_role_success",t.MOVIE_CREATE_SUCCESS="movie_create_success",t}();egret.registerClass(EventName,"EventName");var GameDispatcher=function(t){function e(){t.call(this),e._dispatcher=new egret.EventDispatcher}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(e,"ins",function(){return null==e._ins&&(e._ins=new e),e._ins}),r.dispatchEvent=function(e){return t.prototype.dispatchEvent.call(this,e)},r.dispatchEventWith=function(e,i){return t.prototype.dispatchEventWith.call(this,e,!1,i)
},e}(egret.EventDispatcher);egret.registerClass(GameDispatcher,"GameDispatcher");var HtmlUtil=function(){function t(){}var e=(__define,t),i=e.prototype;return t.getHtmlStr=function(e){var i=t.htmlParser.parser(e);return i},i.test=function(){},t.htmlParser=new egret.HtmlTextParser,t}();egret.registerClass(HtmlUtil,"HtmlUtil");var ModuleIdStatic=function(){function t(){}var e=(__define,t);e.prototype;return t.MAP_MODULE=11,t.MAIN_MODULE=1101,t.CHAT_MODULE=12,t}();egret.registerClass(ModuleIdStatic,"ModuleIdStatic");var StringUtil=function(){function t(){}var e=(__define,t);e.prototype;return t.toboolean=function(t){return null==t?!1:"false"==t?!1:0==t?!1:!0},t.getDay=function(t,e){return 0},t.formatNum=function(t){var e=t.toString();if(e.length>3){for(var i,n=new Array,r=e.length;r>0;)i=Math.max(r-3,0),n.unshift(e.slice(i,r)),r=i;e=n.join(",")}return e},t.GetStringLength=function(t,e){void 0===e&&(e="gb2312");var i=new egret.ByteArray;return i.length},t.getWeekDay=function(t){var e=["日","一","二","三","四","五","六"];return e[t]},t.getChieseNum=function(t){var e=["零","一","二","三","四","五","六","七","八","九","十"];return e[t]},t.formatToTime=function(t){var e=t%60,i=(t-e)/60%60,n=(t-60*i-e)/3600,r=10>e?"0"+e.toString():e.toString(),a=10>i?"0"+i.toString():i.toString(),o=10>n?"0"+n.toString():n.toString();return o+":"+a+":"+r},t.formatToTime_V2=function(t){var e=t%60,i=(t-e)/60%60,n=(t-60*i-e)/3600,r=0==i?"":i.toString()+"分",a=0==n?"":n.toString()+"小时";return a+r+e+"秒"},t.formatToTime_V3=function(t){var e=t%60,i=(t-e)/60%60,n=(t-60*i-e)/3600,r=10>i?"0"+i:i.toString(),a=10>n?"0"+n:n.toString();return a+"时"+r+"分"},t.formatToTime_V4=function(t){var e=t%60,i=(t-e)/60%60,n=10>i?"0"+i:i.toString(),r=10>e?"0"+e:e.toString();return n+"分"+r+"秒"},t.convertTime=function(t,e){void 0===e&&(e=":");var i=Math.ceil(t/3600),n=Math.ceil(t%3600/60),r=Math.ceil(t%60);return(10>i?"0"+i:""+i)+e+(10>n?"0"+n:""+n)+e+(10>r?"0"+r:""+r)},t.resloveFormatLastLoginTime=function(t){var e="";return e},t.resloveFormatLastLoginTime2=function(t){var e=t%60,i=(t-e)/60%60,n=(t%86400-60*i-e)/3600,r=Math.floor(t/86400),a=10>e?"0"+e.toString():e.toString(),o=10>i?"0"+i.toString():i.toString(),s=10>n?"0"+n.toString():n.toString(),h="";return r>0&&(h=r+"天"),h+s+"时"+o+"分"+a+"秒"},t.formatTimeToDay=function(t){var e="";return e},t.formatTimeToMin=function(t){var e="";new Date(1e3*t);return e},t.formatTimeToMin2=function(t){var e="";new Date(1e3*t);return e},t.formatTimeToMin3=function(t){var e="";new Date(1e3*t);return e},t.replaceAllBySplit=function(t,e,i){return null==t?null:t.split(e).join(i)},t.replaceAllByRegex=function(t,e,i){return null==t?null:t.replace(new RegExp(e,"g"),i)},t.randRange=function(t,e){var i=Math.floor(Math.random()*(e-t+1))+t;return i},t.checkNameLength=function(t,e,i){void 0===e&&(e=16),void 0===i&&(i="gb2312");var n="";return n},t.formatTimeToMinSec=function(t){var e=t/60,i=t%60,n=(e>=10?e:"0"+e)+":"+(i>=10?i:"0"+i);return n},t.substitute=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n,r=e.length;1==r&&egret.is(e[0],"Array")?(n=e[0],r=n.length):n=e,t=t.replace(/\\t/g,"	");for(var a=0;r>a;a++)t=t.replace(new RegExp("\\{"+a+"\\}","g"),n[a]);return t},t.getStringLen=function(t,e){void 0===e&&(e=2);var i=0;if(t){for(var n="",r=0;e>r;r++)n+="x";i=t.replace(/[^\x00-\xff]/g,n).length}return i},t}();egret.registerClass(StringUtil,"StringUtil");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(t,e,i){this.textField.text="Loading  "+t+"资源..."+e+"/"+i,egret.log(this.textField.text)},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),App.ins.init(this.stage),App.ins.layer.initLayer(this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(t){"preload"==t.groupName?RES.loadGroup("common"):"common"==t.groupName?RES.loadGroup("cjjs"):"cjjs"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){this.loadingView.setProgress(t.groupName,t.itemsLoaded,t.itemsTotal)},n.startCreateScene=function(){App.ins.moduleManager=new ModuleManager,App.ins.moduleManager.startModule()},n.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,n){function r(t){e.call(n,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);