var App=function(){function e(){this.resManager=null,this.configManager=null}var t=__define,i=e,n=i.prototype;return n.init=function(e){this.stage=e,LoopManager.init(e),this.layer=new LayerManager,this.resManager=new ResourceManager,this.configManager=new LoadConfigManager,this.resManager.initLoopClear()},t(e,"ins",function(){return null==e._ins&&(e._ins=new e),e._ins}),e}();egret.registerClass(App,"App");var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?n(a):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var CBitmapData=function(){function e(e,t){this._count=0,this._texture=t,this._url=e}var t=__define,i=e,n=i.prototype;return t(n,"width",function(){return null==this._texture?0:this._texture.bitmapData.width}),t(n,"height",function(){return null==this._texture?0:this._texture.bitmapData.height}),n.count=function(e){void 0===e&&(e=!0),e?this._count++:this._count--,0==this._count&&(this._lastTime=egret.getTimer())},t(n,"url",function(){return this._url}),t(n,"texture",function(){return this._texture}),n.dispose=function(){this._count>0||LoopManager.currentTime-this._lastTime<3e4||(this._texture.dispose(),this._texture=null)},e}();egret.registerClass(CBitmapData,"CBitmapData");var LayerManager=function(){function e(){this.sceneLayer=new egret.Sprite,this.mainLayer=new egret.Sprite,this.moduleLayer=new egret.Sprite,this.windowLayer=new egret.Sprite,this.popAlertLayer=new egret.Sprite,this.msgLayer=new egret.Sprite,this.topLayer=new egret.Sprite}var t=(__define,e),i=t.prototype;return i.initLayer=function(e){this.container=e,e.addChild(this.sceneLayer),e.addChild(this.mainLayer),e.addChild(this.moduleLayer),e.addChild(this.windowLayer),e.addChild(this.popAlertLayer),e.addChild(this.msgLayer),e.addChild(this.topLayer),UiManager.init()},e}();egret.registerClass(LayerManager,"LayerManager");var LoadConfigManager=function(){function e(){this._configs={},this._loadDic={}}var t=(__define,e),i=t.prototype;return i.getConfig=function(e,t,i,n,a){void 0===i&&(i=null),void 0===n&&(n=0),void 0===a&&(a=null);var r=this._configs[e];if(null==r){var o=this._loadDic[e];null==o&&(o=[],this._loadDic[e]=o,LoadManager.ins.addTextLoad(e,this.onConfigComplete,this,n,a)),o.push({fun:t,data:i})}else{var s={cfg:r,data:i,url:e};t(s)}},i.onConfigComplete=function(e){var t=e.url,i=e.info,n=i._loadDic[t],a=e.data;i._configs[t]=a;for(var r=0;r<n.length;r++){var o=n[r],s={cfg:a,data:o.data,url:t};o.fun(s)}i._loadDic[t]=null,delete i._loadDic[t]},e}();egret.registerClass(LoadConfigManager,"LoadConfigManager");var ResourceManager=function(){function e(){this._inited=!1,this.second=0,this._images={},this._loadDic={}}var t=(__define,e),i=t.prototype;return i.getImageRes=function(e,t,i,n,a){void 0===i&&(i=null),void 0===n&&(n=0),void 0===a&&(a=null);var r=this._images[e];if(null==r){var o=this._loadDic[e];null==o&&(o=[],this._loadDic[e]=o,LoadManager.ins.addImgLoad(e,this.onImageComplete,this,n,a)),o.push({fun:t,data:i})}else{var s={bmd:r,data:i,url:e};t(s)}},i.onImageComplete=function(e){var t=e.info,i=e.url,n=t._loadDic[i],a=e.data,r=new CBitmapData(i,a);t._images[i]=r;for(var o=0;o<n.length;o++){var s=n[o],h={bmd:r,data:s.data,url:i};s.fun(h)}t._loadDic[i]=null,delete t._loadDic[i]},i.loadCompletedByUrl=function(e){return this._images[e]?!0:!1},i.initLoopClear=function(){0==this._inited?(LoopManager.addToSecond("ImageRescourceLoop",this.gc,this),this._inited=!0):(this.second=300,this.gc(this))},i.gc=function(e){if(e.second++,!(e.second<=300)){e.second=0;var t,i={};for(var n in e._images){var t=e._images[n];t.dispose(),null!=t.texture&&(i[n]=t)}e._images=i}},e}();egret.registerClass(ResourceManager,"ResourceManager");var AcorrsLineGrid=function(){function e(e,t){void 0===t&&(t=null),this._isPanX=!1,this._isPanY=!1,this._mapvo=e,this._astartNodes=t,this.nodes=this._mapvo.nodeArray,this.nodeWidth=this._mapvo.nodeWidth,this.nodeHeight=this._mapvo.nodeHeight,this.arrange=new Arrange,this.arrange.key="f"}var t=(__define,e),i=t.prototype;return i.reset=function(e){this._mapvo=e,this.nodes=this._mapvo.nodeArray,this.nodeWidth=this._mapvo.nodeWidth,this.nodeHeight=this._mapvo.nodeHeight},i.getPsnode=function(e){if(null==e&&(e=this._astartNodes),null==e||null==this._mapvo)throw new Error("没有合适节点可供计算：in AcorrsLineGrid");var t=e.length;if(3>t)return e;var i=[],n=e[0],a=e[t-1],r=0;for(i.push(n);n!=a;)for(var o=t-1;o>r;o--){var s=e[o],h=o-r==1?!0:!1;if(h||this.isCorrsed(n,s)){n=s,r=o,i.push(s);break}}return i},i.isCorrsed=function(e,t){function i(e,t){return t._isPanY?t._panYvalue:(e-t._b)/t._k}function n(e,t){return t._isPanX?t._panXvalue:t._k*e+t._b}function a(e,t){var i,n,a=r(e);switch(a){case 4:i=t.nodes[e.y][e.x-1],n=t.nodes[e.y-1][e.x];break;case-2:i=t.nodes[e.y][e.x-1],n=t.nodes[e.y+1][e.x];break;case-4:i=t.nodes[e.y][e.x+1],n=t.nodes[e.y+1][e.x];break;case 2:i=t.nodes[e.y][e.x+1],n=t.nodes[e.y+1][e.x];break;default:return!1}return i.walkAble||n.walkAble?!1:!0}function r(e){var t=3*(e.y-o.y)+(e.x-o.x);return t}if(!e||!t)return!1;this._isPanX=e.y==t.y,this._isPanY=e.x==t.x,this._isPanX||this._isPanY?(this._isPanX&&(this._panXvalue=e.y*this.nodeHeight),this._isPanY&&(this._panYvalue=e.x*this.nodeWidth)):(this._k=(t.y-e.y)*this.nodeHeight/((t.x-e.x)*this.nodeWidth),this._b=(t.y+.5)*this.nodeHeight-(t.x+.5)*this.nodeWidth*this._k);var o,s,h,l,d=Math.min(t.x,e.x),c=Math.max(t.x,e.x),u=Math.min(e.y,t.y),_=Math.max(e.y,t.y),p=(d+.5)*this.nodeWidth,g=(c+.5)*this.nodeWidth,m=(u+.5)*this.nodeHeight,f=(_+.5)*this.nodeHeight;o=e.x<t.x?e:t;var v;for(v=d;c>=v;v++){if(s=v*this.nodeWidth+1,s>=p&&g>=s){if(h=n(s,this),l=this._mapvo.getNodeByXY(s,h),!l.walkAble)return!1;if(a(l,this))return!1;o=l}if(s=(v+1)*this.nodeWidth-1,s>=p&&g>=s){if(h=n(s,this),l=this._mapvo.getNodeByXY(s,h),!l.walkAble)return!1;if(a(l,this))return!1;o=l}}for(l=e.y<t.y?e:t,v=u;_>=v;v++){if(h=v*this.nodeHeight+1,h>=m&&f>=h){if(s=i(h,this),l=this._mapvo.getNodeByXY(s,h),!l.walkAble)return!1;if(a(l,this))return!1;o=l}if(h=(v+1)*this.nodeHeight-1,h>=m&&f>=h){if(s=i(h,this),l=this._mapvo.getNodeByXY(s,h),!l.walkAble)return!1;if(a(l,this))return!1;o=l}}return!0},e}();egret.registerClass(AcorrsLineGrid,"AcorrsLineGrid");var Arrange=function(){function e(){this._desending=!0,this.init()}var t=__define,i=e,n=i.prototype;return n.init=function(){this._arr=[],this._compareFun=this.compares},t(n,"desending",void 0,function(e){this._desending=e}),n.put=function(e){var t=this._arr.length;if(1>t)return void this._arr.push(e);for(var i=0,n=t-1;t>1;){var a=Math.floor(i+t/2),r=this._compareFun(e,this._arr[a]);switch(r){case-1:i=a;break;case 0:return void this._arr.splice(a,0,e);case 1:n=a}t=n-i}return r=this._compareFun(e,this._arr[i]),1==r||0==r?void this._arr.splice(i,0,e):(r=this._compareFun(e,this._arr[n]),1==r||0==r?void this._arr.splice(n,0,e):void this._arr.splice(n+1,0,e))},t(n,"key",void 0,function(e){null!=e&&""!=e&&(this._key=e)}),t(n,"compareWitchNum",void 0,function(e){e&&(this._compareFun=this.cwitchNum)}),n.cwitchNum=function(e,t){var i=e-t;return this._desending||(i*=-1),0>i?-1:i>0?1:0},n.compares=function(e,t){var i=e[this._key]-t[this._key];return this._desending||(i*=-1),0>i?-1:i>0?1:0},n.pop=function(){return this._arr.pop()},n.shift=function(){return this._arr.shift()},t(n,"array",function(){return this._arr}),n.clear=function(){this._arr=[]},n.rePlaceArr=function(e,t,i){if(void 0===t&&(t=!0),void 0===i&&(i=""),null==e||e.length<2)return e;(null==i||""==i)&&(this._compareFun=this.cwitchNum),this.desending=t,this.clear();for(var n in e)this.put(e[n]);return e=this.array},e}();egret.registerClass(Arrange,"Arrange");var Astart=function(){function e(){this._version=0,this.sqrt_2=Math.SQRT2}var t=(__define,e),i=t.prototype;return e.findPath=function(t){return null==t||null==t.startNode||null==t.endNode?null:(null==e._instance&&(e._instance=new e),e._instance.hasPath(t))},i.hasPath=function(t){e._onlyIdNum++,e._vistedNum=0,this._arrange=new Arrange,this._arrange.key="h",this._findFun=this.euclidian,this._startNode=t.startNode,this._endNode=t.endNode;var i=this._startNode;i.f=0,i.g=i.h=0;for(var n=t.col-1,a=t.row-1,r=t.nodeArray,o=0,s=0,h=e._onlyIdNum;i!=this._endNode;){var l=i.x-1,d=i.x+1,c=i.y-1,u=i.y+1;0>l&&(l=0),d>n&&(d=n),0>c&&(c=0),u>a&&(u=a);for(var _=l;d>=_;_++)for(var p=c;u>=p;p++){e._vistedNum++;var g=r[p][_];if(g.visitTime!=h&&(g.visited=!1,g.visitTime=h),null!=g&&g.walkAble&&g!=i){var m=!(g.x==i.x||g.y==i.y);if(m){var f=r[g.y][i.x],v=r[i.y][g.x];if(0==f.walkAble&&0==v.walkAble)continue}var E=m?1.4:1,M=i.f+E;g.visited?(o++,g.f>M&&(g.f=M,g.h=g.f+g.g,g.parent=i)):(s++,g.visited=!0,g.f=M,g.g=this._findFun(g),g.h=g.f+g.g,g.parent=i,this._arrange.put(g))}}if(i=this._arrange.pop(),null==i)return null}for(var y=[];i!=this._startNode;)y.push(i),i=i.parent;return y.push(i),e.ProfectPath&&(y=e.profect(y)),y},e.profect=function(e){function t(e){return 10*(e.y-o.y)+(e.x-o.x)}if(null==e||e.length<3)return e;var i,n,a,r=[],o=e[0],s=t(e[1]);r.push(o);for(var h,l=(egret.getTimer(),1);l<e.length;l++)a=e[l],n=t(a),n!=s?(h++,i&&r.push(i),i=a,s=n):i=a,o=a;return r.push(i),r},i.euclidian=function(e){var t=this._endNode.x-e.x,i=this._endNode.y-e.y;return t*t+i*i},i.diagonal=function(e){var t=this._endNode.x-e.x,i=this._endNode.y-e.y;0>t&&(t*=-1),0>i&&(i*=-1);var n=i>t?t:i;return n*this.sqrt_2+(t+i-2*n)},i.manhattan=function(e){var t=this._endNode.x-e.x,i=this._endNode.y-e.y;return 0>t&&(t*=-1),0>i&&(i*=-1),t+i},e.ProfectPath=!1,e._vistedNum=0,e._onlyIdNum=0,e}();egret.registerClass(Astart,"Astart");var MapNode=function(){function e(e){this.visited=!1,this.visitTime=0,this.isMask=!1,this.isSwim=!1,this.isSafe=!0,this.walkAble=!0}var t=(__define,e),i=t.prototype;return i.reset=function(){this.f=0,this.g=0,this.h=0,this.x=0,this.y=0,this.visitTime=0,this.walkAble=!0,this.visited=!1,this.isMask=!1,this.isSwim=!1,this.isSafe=!0},e.getNode=function(){var t;return 0==e.nodePool.length?(t=new e(new Single),e.numCount++):t=e.nodePool.shift(),t},i.dispose=function(){this.reset(),e.nodePool.push(this)},e.nodePool=[],e.numCount=0,e}();egret.registerClass(MapNode,"MapNode");var Single=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(Single,"Single");var MapConfig=function(){function e(){}var t=(__define,e);t.prototype;return e.MAP_SCREEN_WIDTH=480,e.MAP_SCREEN_HEIGHT=800,e.MAP_CLIP_IMAGE_WIDTH=256,e.MAP_CLIP_IMAGE_HEIGHT=256,e.MAP_NODE_WIDTH=64,e.MAP_NODE_HEIGHT=64,e.version="",e.res_url="map/",e}();egret.registerClass(MapConfig,"MapConfig");var MapDataConvert=function(){function e(){}var t=(__define,e),i=t.prototype;return i.numbertranfromToMapVO=function(e){return this.convertMapVO(e)},i.convertMapVO=function(e){var t=new egret.ByteArray(e);null==this.mapdata?this.mapdata=new MapVo:this.mapdata.dispose();var i=this.mapdata;t.position=4,i.version=t.readFloat();var n=t.readInt();t.position=42,i.col=this.readShort(t),i.row=this.readShort(t),t.position+=2,i.nodeArray=[],i.doors=[];for(var a,r=0;r<i.col;r++)for(var o=0;o<i.row;o++){null==i.nodeArray[o]&&(i.nodeArray[o]=[]);var s=t.readByte(),h=(1&s)>0?!0:!1,l=(16&s)>0?!0:!1,d=(2&s)>0?!0:!1,c=(8&s)>0?!0:!1,u=0;h?(u=1,l&&(u=2)):u=0,a=MapNode.getNode(),a.x=r,a.y=o,a.isMask=l,a.isSwim=d,a.walkAble=h,a.isSafe=c,i.nodeArray[o][r]=a,t.position+=1}i.mapWidth=t.readShort(),i.mapHeight=t.readShort(),i.nodeWidth=t.readShort(),i.nodeHeight=t.readShort(),i.tileWidth=t.readShort(),i.tileHeight=t.readShort();var _=Math.ceil(i.mapWidth/MapConfig.MAP_CLIP_IMAGE_WIDTH),p=Math.ceil(i.mapHeight/MapConfig.MAP_CLIP_IMAGE_HEIGHT);for(i.tileArray=[],r=0;p>r;r++)for(null==i.tileArray[r]&&(i.tileArray[r]=[]),o=0;_>o;o++)i.tileArray[r][o]=o+"_"+r+".jpg";var g=[];if(n>0)for(r=0;n>r;r++){var m=new MapEffectVo;m.tempID=r,m.sid=t.readInt(),m.sx=t.readShort(),m.sy=t.readShort(),m.scaleX=t.readDouble(),m.scaleY=t.readDouble(),m.rotation=t.readInt(),g.push(m)}return i.mapEffectList=g,i.mapId=parseInt(t.readUTF()),i.previewImageUrl=t.readUTF(),t.clear(),i},i.readShort=function(e){var t=new egret.ByteArray,i=e.readByte(),n=e.readByte();return t.writeByte(n),t.writeByte(i),t.position=0,t.readShort()},e}();egret.registerClass(MapDataConvert,"MapDataConvert");var MapLoadProxy=function(e){function t(){e.call(this),this._mapConvert=null,this._mapData=null,this._waitClips={},this._mapConvert=new MapDataConvert}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.setBgView=function(e){this._bgView=e},a.setMapId=function(e){this._mapid=e;var i=StringUtil.substitute(t.mapCfgSrc,e);LoadManager.ins.addByteLoad(i,this.onLoadMapCfgHandler,this,LoadPriorityEnum.MAPCONFIG_PRIORITY),this.loadSmallMap()},a.onLoadMapCfgHandler=function(e){var t=e.info;t._mapData=t._mapConvert.numbertranfromToMapVO(e.data),t._mapData.mapId=t._mapid,t.dispatchEventWith(SceneEventName.GAMEMAP_DATA_LOAD_COMPLETE,!1,t._mapData),t.drawMark()},i(a,"mapData",function(){return this._mapData}),a.loadSmallMap=function(){this._previewTexture=null;var e=StringUtil.substitute(t.mapClipSrc,this._mapid,"preview.jpg");LoadManager.ins.addImgLoad(e,this.onLoadSmallMapComplete,this,LoadPriorityEnum.MAPCONFIG_PRIORITY)},a.onLoadSmallMapComplete=function(e){var t=e.info;t._previewTexture=e.data,t.drawMark()},a.drawMark=function(){null!=this._mapData&&null!=this._previewTexture&&this._bgView.setMark(this._previewTexture,this._mapData.mapWidth,this._mapData.mapHeight)},a.loadClips=function(e){for(var i=this._mapData,n=0;n<e.length;n++){var a=e[n];if(i.tileArray[a.x]&&i.tileArray[a.x][a.y]){var r=i.tileArray[a.x][a.y],o=StringUtil.substitute(t.mapClipSrc,i.mapId,r);if(this._bgView.hasClipBmp(o)||null!=this._waitClips[o])continue;this._waitClips[o]=o;var s={mapid:i.mapId,url:o,self:this,x:a.x,y:a.y};LoadManager.ins.addImgLoad(o,this.loadMapComplete,s,LoadPriorityEnum.MAPCLIP_PRIORITY)}}},a.loadMapComplete=function(e){var t=e.info,i=t.self,n=t.x,a=t.y,r=t.url,o=t.mapid;if(i._mapid==o){i._waitClips[r]=null,delete i._waitClips[r];var s=new egret.Bitmap(e.data);s.x=n*MapConfig.MAP_CLIP_IMAGE_WIDTH,s.y=a*MapConfig.MAP_CLIP_IMAGE_HEIGHT,i._bgView.setClipBmd(r,s)}},a.clear=function(){for(var e in this._waitClips)LoadManager.ins.clearLoad(e);this._waitClips={},this._mapData=null},t.mapCfgSrc="resource/map/map{0}/data.mp",t.mapClipSrc="resource/map/map{0}/{1}",t}(egret.EventDispatcher);egret.registerClass(MapLoadProxy,"MapLoadProxy");var MapSceneProxy=function(){function e(){this._mapArea=null,this._sceneRect=null,this._rolePoint=null,this.init()}var t=__define,i=e,n=i.prototype;return n.init=function(){this._rolePoint=new egret.Point(0,0),this._mapArea=new egret.Rectangle(0,0,0,0),this._sceneRect=new egret.Rectangle(0,0,MapConfig.MAP_SCREEN_WIDTH,MapConfig.MAP_SCREEN_HEIGHT)},t(n,"sceneRect",function(){return this._sceneRect}),n.upMapAreaRect=function(e,t,i){void 0===i&&(i=!1),this._mapArea.width=e,this._mapArea.height=t,i&&this.moveScene()},n.upSceneRect=function(e,t,i){void 0===i&&(i=!1),this._sceneRect.width=e,this._sceneRect.height=t,MapConfig.MAP_SCREEN_WIDTH=e,MapConfig.MAP_SCREEN_HEIGHT=t,i&&this.moveScene()},n.setRolePoint=function(e,t,i){void 0===i&&(i=!1),this._rolePoint.x=e,this._rolePoint.y=t,i&&this.moveScene()},n.moveScene=function(){this.sceneRect.x=this._rolePoint.x-this.sceneRect.width/2,this.sceneRect.y=this._rolePoint.y-this.sceneRect.height/2,this.sceneRect.width>this._mapArea.width?this.sceneRect.x=(this._mapArea.width-this.sceneRect.width)/2:this.sceneRect.x<0?this.sceneRect.x=0:this.sceneRect.x+this.sceneRect.width>this._mapArea.width&&(this.sceneRect.x=this._mapArea.width-this.sceneRect.width),this.sceneRect.height>this._mapArea.height?this.sceneRect.y=(this._mapArea.height-this.sceneRect.height)/2:this.sceneRect.y<0?this.sceneRect.y=0:this.sceneRect.y+this.sceneRect.height>this._mapArea.height&&(this.sceneRect.y=this._mapArea.height-this.sceneRect.height)},t(n,"clips",function(){for(var e=[],t=(SceneManager.ins.mapData,Math.floor((this._sceneRect.x-MapConfig.MAP_CLIP_IMAGE_WIDTH)/MapConfig.MAP_CLIP_IMAGE_WIDTH)),i=Math.floor((this._sceneRect.y-MapConfig.MAP_CLIP_IMAGE_HEIGHT)/MapConfig.MAP_CLIP_IMAGE_HEIGHT),n=Math.floor((this._sceneRect.x+this._sceneRect.width+MapConfig.MAP_CLIP_IMAGE_WIDTH)/MapConfig.MAP_CLIP_IMAGE_WIDTH),a=Math.floor((this._sceneRect.y+this._sceneRect.height+MapConfig.MAP_CLIP_IMAGE_HEIGHT)/MapConfig.MAP_CLIP_IMAGE_HEIGHT),r=t;n>=r;r++)for(var o=i;a>o;o++)e.push({x:r,y:o});return e}),e}();egret.registerClass(MapSceneProxy,"MapSceneProxy");var MapEffectVo=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(MapEffectVo,"MapEffectVo");var MapVo=function(){function e(){this.mapWidth=0,this.mapHeight=0,this.row=0,this.col=0,this.version=0}var t=(__define,e),i=t.prototype;return i.dispose=function(){if(null!=this.nodeArray){for(var e=0;e<this.nodeArray.length;e++)for(var t=0;t<this.nodeArray[e].length;t++)this.nodeArray[e][t].dispose();this.nodeArray=null}},i.getNodeByXY=function(e,t){var i=e/this.nodeWidth,n=t/this.nodeHeight;return this.getNode(i,n)},i.getNode=function(e,t){return e=Math.floor(e),t=Math.floor(t),t>=0&&e>=0&&t<this.row&&e<this.col?this.nodeArray[t][e]:null},e.transNodePoint=function(e,t){return void 0===t&&(t=null),null==t&&(t=new egret.Point(0,0)),t.x=(e.x+.5)*MapConfig.MAP_NODE_WIDTH,t.y=(e.y+.5)*MapConfig.MAP_NODE_HEIGHT,t},e.getCenterPoint=function(e,t){var i=new egret.Point;return i.x=(e+.5)*MapConfig.MAP_NODE_WIDTH,i.y=(t+.5)*MapConfig.MAP_NODE_HEIGHT,i},e.getPoint=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0);var n=new egret.Point;return n},e}();egret.registerClass(MapVo,"MapVo");var SceneEventName=function(){function e(){}var t=(__define,e);t.prototype;return e.UPDATA_ROLE_SIZE="updataRoleSize",e.GAMEMAP_DATA_LOAD_COMPLETE="gameMap_data_load_complete",e.MY_ROLE_CHANGE_POSITION="my_role_change_position",e}();egret.registerClass(SceneEventName,"SceneEventName");var BaseMapLayer=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.clear=function(){},t}(egret.DisplayObjectContainer);egret.registerClass(BaseMapLayer,"BaseMapLayer");var MapAvatarLayer=function(e){function t(){e.call(this),this._childList=[]}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){},n.addChild=function(t){return-1!=this._childList.indexOf(t)?t:(this._childList.push(t),e.prototype.addChild.call(this,t))},n.removeChild=function(t){var i=this._childList.indexOf(t);return-1==i?t:(this._childList.splice(i,1),e.prototype.addChild.call(this,t))},n.clear=function(){for(;this.numChildren>0;)e.prototype.removeChildAt.call(this,0);this._childList.length=0},n.doSortAvatar=function(){var e=this._childList,t=e.length;e.sort(this.sort);for(var i=null;t--;)i=e[t],this.setChildIndex(i,t)},n.sort=function(e,t){return e.y<t.y?1:0},t}(BaseMapLayer);egret.registerClass(MapAvatarLayer,"MapAvatarLayer");var MapBackGroundLayer=function(e){function t(){e.call(this),this._hasClips={},this._markBmp=null,this._markBmp=new egret.Bitmap,this.addChild(this._markBmp)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.drawNodes=function(e){if(null==this._nodeLayer&&(this._nodeLayer=new egret.Shape),this._nodeLayer.parent)return void this.parent.removeChild(this._nodeLayer);if(this.parent.addChild(this._nodeLayer),this._nodeLayer.graphics.clear(),e)for(var t=0;t<e.row;t++)for(var i=0;i<e.col;i++){var n=e.getNode(i,t).walkAble,a=e.getNode(i,t).isMask,r=16711680;n&&(r=a?65280:16777215);var o=16777215==r?0:.6;this._nodeLayer.graphics.beginFill(r,o),this._nodeLayer.graphics.lineStyle(1,6710886,1),this._nodeLayer.graphics.drawRect(MapConfig.MAP_NODE_WIDTH*i,MapConfig.MAP_NODE_HEIGHT*t,MapConfig.MAP_NODE_WIDTH,MapConfig.MAP_NODE_HEIGHT),this._nodeLayer.graphics.endFill()}},n.setMark=function(e,t,i){var n=t/e.bitmapData.width,a=i/e.bitmapData.height,r=new egret.Matrix;r.scale(n,a),this._markBmp.matrix=r,this._markBmp.texture=e},n.setClipBmd=function(e,t){this._hasClips[e]=t,this.addChild(t)},n.hasClipBmp=function(e){return null!=this._hasClips[e]?!0:!1},n.clearClips=function(e,i){if(!(this.numChildren<t.MAX_CLIP_NUM)){var n=e-MapConfig.MAP_CLIP_IMAGE_WIDTH,a=e+MapConfig.MAP_SCREEN_WIDTH+MapConfig.MAP_CLIP_IMAGE_WIDTH,r=i-MapConfig.MAP_CLIP_IMAGE_HEIGHT,o=i+MapConfig.MAP_SCREEN_HEIGHT+MapConfig.MAP_CLIP_IMAGE_HEIGHT,s=[];for(var h in this._hasClips){var l=this._hasClips[h];(l.x<n||l.x>a||l.y<r||l.y>o)&&s.push(h)}for(var d=0;d<s.length;d++){h=s[d];var l=this._hasClips[h];this._hasClips[h]=null,delete this._hasClips[h],this.contains(l)&&this.removeChild(l),l.texture.dispose(),l=null}}},n.clear=function(){this._nodeLayer&&(this._nodeLayer.graphics.clear(),this._nodeLayer.parent&&this.parent.removeChild(this._nodeLayer),this._nodeLayer=null);for(var e in this._hasClips){var t=this._hasClips[e];this.contains(t)&&this.removeChild(t),t.texture.dispose(),t=null}this._hasClips={},null!=this._markBmp.texture&&(this._markBmp.texture.dispose(),this._markBmp.texture=null)},t.MAX_CLIP_NUM=60,t}(BaseMapLayer);egret.registerClass(MapBackGroundLayer,"MapBackGroundLayer");var MapEffectLayer=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t);i.prototype;return t}(BaseMapLayer);egret.registerClass(MapEffectLayer,"MapEffectLayer");var MapContainer=function(e){function t(){e.call(this),this.touchEnabled=!0;var t=new egret.Shape;t.graphics.beginFill(16777215,1),t.graphics.drawRect(0,0,MapConfig.MAP_SCREEN_WIDTH,MapConfig.MAP_SCREEN_HEIGHT),t.graphics.endFill(),this.addChild(t)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.clear=function(){},n.updataPosition=function(e,t){this.x=-1*e,this.y=-1*t},t}(egret.DisplayObjectContainer);egret.registerClass(MapContainer,"MapContainer");var LoaderThread=function(e){function t(){e.call(this)}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.reset=function(){this.isLoad=!1,this.loadInfo=null},a.load=function(e){switch(this.loadInfo=e,this.isLoad=!0,e.loadType){case LoadInfo.GROUP:RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onLoadGroupProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onLoadGroupError,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onLoadGroupComplete,this),RES.loadGroup(e.url);break;case LoadInfo.JSON:RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onLoadConfigComplete,this),RES.addEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onLoadConfigError,this),RES.loadConfig(e.url);break;case LoadInfo.IMG:var t=this.urlLoad;t.dataFormat=egret.URLLoaderDataFormat.TEXTURE,t.addEventListener(egret.Event.COMPLETE,this.onUrlLoadComplete,this),t.addEventListener(egret.ProgressEvent.PROGRESS,this.onTextLoadProgress,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onTextLoadError,this),t.load(new egret.URLRequest(e.url));break;case LoadInfo.TEXT:case LoadInfo.XML:var t=this.urlLoad;t.dataFormat=egret.URLLoaderDataFormat.TEXT,t.addEventListener(egret.Event.COMPLETE,this.onUrlLoadComplete,this),t.addEventListener(egret.ProgressEvent.PROGRESS,this.onTextLoadProgress,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onTextLoadError,this),t.load(new egret.URLRequest(e.url));break;case LoadInfo.BYTE:var t=this.urlLoad;t.dataFormat=egret.URLLoaderDataFormat.BINARY,t.addEventListener(egret.Event.COMPLETE,this.onUrlLoadComplete,this),t.addEventListener(egret.ProgressEvent.PROGRESS,this.onTextLoadProgress,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onTextLoadError,this),t.load(new egret.URLRequest(e.url))}},a.onUrlLoadComplete=function(e){var t=e.target;this.loadInfo.data=t.data,this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))},a.onLoadConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onLoadConfigComplete,this),this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))},a.onLoadGroupComplete=function(e){RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onLoadGroupProgress,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onLoadGroupError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onLoadGroupComplete,this),this.dispatchEvent(new egret.Event(egret.Event.COMPLETE))},a.onLoadGroupProgress=function(e){this.dispatchEventWith(egret.ProgressEvent.PROGRESS,!1,{loaded:e.itemsLoaded,total:e.itemsTotal})},a.onImgLoadProgress=function(e){this.dispatchEventWith(egret.ProgressEvent.PROGRESS,!1,{loaded:e.bytesLoaded,total:e.bytesTotal})},a.onTextLoadProgress=function(e){this.dispatchEventWith(egret.ProgressEvent.PROGRESS,!1,{loaded:e.bytesLoaded,total:e.bytesTotal})},a.onLoadGroupError=function(e){this.loadInfo.errorHandler&&this.loadInfo.errorHandler(this.loadInfo),this.dispatchEventWith(egret.IOErrorEvent.IO_ERROR,!1,{text:"加载"+e.groupName+"资源组时出错"})},a.onLoadConfigError=function(e){this.dispatchEventWith(egret.IOErrorEvent.IO_ERROR,!1,{text:"加载"+this.loadInfo.url+"json配置时出错"})},a.onImgLoadError=function(e){this.dispatchEventWith(egret.IOErrorEvent.IO_ERROR,!1,{text:"加载"+this.loadInfo.url+"出错"})},a.onTextLoadError=function(e){this.dispatchEventWith(egret.IOErrorEvent.IO_ERROR,!1,{text:"加载"+this.loadInfo.url+"出错"})},i(a,"urlLoad",function(){return null==this._urlLoad&&(this._urlLoad=new egret.URLLoader),this._urlLoad}),i(a,"imgLoader",function(){return null==this._imgLoad&&(this._imgLoad=new egret.ImageLoader),this._imgLoad}),t}(egret.EventDispatcher);egret.registerClass(LoaderThread,"LoaderThread");var LoadInfo=function(){function e(e,t,i,n,a,r){void 0===i&&(i=null),void 0===n&&(n=0),void 0===a&&(a=null),void 0===r&&(r=null),this.createTime=0,this.url=e,this.completeHandler=t,this.info=i,this.priority=n,this.progressHandler=a,this.errorHandler=r,this.createTime=egret.getTimer()}var t=(__define,e);t.prototype;return e.XML="xml",e.BYTE="byte",e.JSON="json",e.IMG="IMG",e.TEXT="text",e.GROUP="group",e}();egret.registerClass(LoadInfo,"LoadInfo");var LoadManager=function(){function e(){this.waitLoadList=[],this._max_thread=5,this._loadMapByUrl={},this._isGetVersion=!0,this.init()}var t=__define,i=e,n=i.prototype;return t(e,"ins",function(){return null==e._ins&&(e._ins=new e),e._ins}),n.addGroupLoad=function(e,t,i,n,a){void 0===i&&(i=null),void 0===n&&(n=0),void 0===a&&(a=null);var r=new LoadInfo(e,t,i,n,a);r.loadType=LoadInfo.GROUP,this.load(r)},n.addConfigLoad=function(e,t,i,n,a){void 0===i&&(i=null),void 0===n&&(n=0),void 0===a&&(a=null);var r=new LoadInfo(e,t,i,n,a);r.loadType=LoadInfo.JSON},n.addImgLoad=function(e,t,i,n,a){void 0===i&&(i=null),void 0===n&&(n=0),void 0===a&&(a=null);var r=new LoadInfo(e,t,i,n,a);r.loadType=LoadInfo.IMG,this.load(r)},n.addTextLoad=function(e,t,i,n,a){void 0===i&&(i=null),void 0===n&&(n=0),void 0===a&&(a=null);var r=new LoadInfo(e,t,i,n,a);r.loadType=LoadInfo.TEXT,this.load(r)},n.addByteLoad=function(e,t,i,n,a){void 0===i&&(i=null),void 0===n&&(n=0),void 0===a&&(a=null);var r=new LoadInfo(e,t,i,n,a);r.loadType=LoadInfo.BYTE,this.load(r)},n.clearLoad=function(e){var t=this._loadMapByUrl[e];null!=t&&(t=null,delete this._loadMapByUrl[e])},n.load=function(e){if(null!=e){var t=this._loadMapByUrl[e.url];if(null!=t){for(var i=0;i<t.length;i++){var n=t[i];if(n.completeHandler==e.completeHandler)return}t.push(e)}else t=new Array,t.push(e),this._loadMapByUrl[e.url]=t;var a=this.getFreeLoader();null!=a?a.load(e):(this.waitLoadList.push(e),this.waitLoadList.sort(function(e,t){return e.priority>t.priority?1:(e.priority>t.priority&&e.createTime<t.createTime,0)}))}},n.getFreeLoader=function(){var e;return this._freePools.length>0?e=this._freePools.pop():null},n.init=function(){this._freePools=[],this._taskLoads=[];for(var e,t=0;t<this._max_thread;t++)e=new LoaderThread,e.addEventListener(egret.Event.COMPLETE,this.loadComplete,this),e.addEventListener(egret.ProgressEvent.PROGRESS,this.loadProgress,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.IoErrorHandle,this),this._freePools.push(e),this._taskLoads.push(e)},n.recrycleLoad=function(e){e.loadInfo.url;e.reset(),this._freePools.push(e),this.loadNext()},n.loadNext=function(){function e(e,t){egret.clearTimeout(n),e.load(t)}for(;this.waitLoadList.length>0;){var t=this.getFreeLoader();if(null==t)return;var i=this.waitLoadList.shift(),n=egret.setTimeout(e,this,1,t,i)}},n.loadComplete=function(e){var t=e.target,i=t.loadInfo,n=this._loadMapByUrl[i.url];if(null==n)return void this.recrycleLoad(t);this._loadMapByUrl[i.url]=null,delete this._loadMapByUrl[i.url],this.recrycleLoad(t);for(var a=0;a<n.length;a++){var r=n[a];r.data=i.data,r.content=i.content,r.completeHandler&&r.completeHandler(r)}},n.loadProgress=function(e){var t=e.target;t.loadInfo&&t.loadInfo.progressHandler&&t.loadInfo.progressHandler(e.data)},n.IoErrorHandle=function(e){var t=e.target,i=t.loadInfo.url;t.loadInfo&&t.loadInfo.errorHandler&&t.loadInfo.errorHandler(t.loadInfo),this._loadMapByUrl[i]=null,this.recrycleLoad(t),egret.log(e.data)},e}();egret.registerClass(LoadManager,"LoadManager");var LoadPriorityEnum=function(){function e(){}var t=(__define,e);t.prototype;return e.SOUND_PROPITY=15,e.IMAGE_PRIORITY=5,e.MAPCLIP_PRIORITY=1,e.MAPCONFIG_PRIORITY=10,e.EFFECT_PRIORITY=0,e.AVATAR_PRIORITY=2,e.MY_AVATAR_PRIORITY=9,e}();egret.registerClass(LoadPriorityEnum,"LoadPriorityEnum");var CustomMoviClip=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setRes=function(e,t,i){this._resData=e,this._mcTexture=t,this._mcName=i,this._mcBitmap&&(this._mcBitmap.count(!1),this._mcBitmap=null),this.createMc()},n.startLoad=function(e,t,i){void 0===i&&(i=0),this._url==e&&this.isPlaying||(this._mcBitmap&&(this._mcBitmap.count(!1),this._mcBitmap=null),this._url=e,App.ins.configManager.getConfig(e+".json",this.onLoadTxtComplete,this,i),App.ins.resManager.getImageRes(e+".png",this.onLoadImgComplete,this,i))},n.onLoadTxtComplete=function(e){var t=e.data;t._resData=JSON.parse(e.cfg),t.createMc()},n.onLoadImgComplete=function(e){var t=e.data;t._mcBitmap=e.bmd,e.bmd.count(!0),t._mcTexture=e.bmd.texture,t.createMc()},n.createMc=function(){var e=this;if(null!=e._resData&&null!=e._mcTexture&&null!=e._mcTexture.bitmapData){var t=new egret.MovieClipDataFactory(this._resData,this._mcTexture);e.movieClipData=t.generateMovieClipData(e._mcName),e.play(-1),this.dispatchEvent(new egret.Event(EventName.MOVIE_CREATE_SUCCESS))}},n.dispos=function(){this.stop(),this._resData=null,null!=this._mcBitmap&&(this._mcBitmap.count(!1),this._mcBitmap=null),this._mcTexture=null,this.parent&&this.parent.removeChild(this)},t}(egret.MovieClip);egret.registerClass(CustomMoviClip,"CustomMoviClip");var Avatar=function(e){function t(){e.call(this),this._newDir=0,this.bodyHeight=0;var t=new CustomMoviClip;this._bodyMc=t,this._bodyMc.addEventListener(EventName.MOVIE_CREATE_SUCCESS,this.createBodyComplete,this),this.addChild(t)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setAvatarData=function(e){this._roleData=e,this.upDataAct()},n.upDataAct=function(){var e=this._roleData.dir,i=this._roleData.state;this._newDir=this.getFiveDir(e,this._bodyMc);var n=StringUtil.substitute(t.ROLEKEY,this._roleData.dress,this._roleData.sex,this._newDir,i),a=StringUtil.substitute(t.roleUrl,this._roleData.sex,n);this._bodyMc.startLoad(a,n,LoadPriorityEnum.AVATAR_PRIORITY),this.checkWeapon()},n.onBodyEnterFrame=function(){this._weaponMc&&null!=this._weaponMc.movieClipData&&this._weaponMc.gotoAndStop(this._bodyMc.currentFrame)},n.createBodyComplete=function(e){var t=this;t.bodyHeight<t._bodyMc.height&&(t.bodyHeight=t._bodyMc.height,t.dispatchEvent(new egret.Event(SceneEventName.UPDATA_ROLE_SIZE,!1)))},n.checkWeapon=function(){if(this._roleData.type==RoleType.TYPE_PLAYER){null==this._weaponMc&&(this._weaponMc=new CustomMoviClip,this._weaponMc.addEventListener(EventName.MOVIE_CREATE_SUCCESS,this.createWeaponComplete,this),this.addChild(this._weaponMc));var e=this._roleData.dir,i=this._roleData.state,n=StringUtil.substitute(t.WEAPONKEY,this._newDir,i);
this._newDir=this.getFiveDir(e,this._weaponMc);var a=StringUtil.substitute(t.WEAPONURL,n);this._weaponMc.startLoad(a,n,LoadPriorityEnum.AVATAR_PRIORITY),this._bodyMc.hasEventListener(egret.Event.ENTER_FRAME)||this._bodyMc.addEventListener(egret.Event.ENTER_FRAME,this.onBodyEnterFrame,this)}else this._bodyMc.hasEventListener(egret.Event.ENTER_FRAME)&&this._bodyMc.removeEventListener(egret.Event.ENTER_FRAME,this.onBodyEnterFrame,this)},n.createWeaponComplete=function(){},n.getFiveDir=function(e,t){var i=e,n=1;switch(e){case SceneType.LEFT_BOTTOME:n=-1,i=SceneType.RIGHT_BOTTOME;break;case SceneType.LEFT:n=-1,i=SceneType.RIGHT;break;case SceneType.LEFT_TOP:n=-1,i=SceneType.RIGHT_TOP}return t.scaleX=n,i},n.stop=function(){this._bodyMc.stop(),this._weaponMc&&this._weaponMc.gotoAndStop(this._bodyMc.currentFrame)},n.gotoAndStop=function(e){this._bodyMc.gotoAndStop(e),this._weaponMc&&this._weaponMc.gotoAndStop(this._bodyMc.currentFrame)},n.gotoAndPlay=function(e,t){void 0===t&&(t=0),this._bodyMc.gotoAndPlay(e,t),this._weaponMc&&this._weaponMc.gotoAndPlay(e,t)},n.clear=function(){this._roleData=null,this._bodyMc.removeEventListener(EventName.MOVIE_CREATE_SUCCESS,this.createBodyComplete,this),this._bodyMc.dispos(),this._bodyMc=null,this._weaponMc&&(this._weaponMc.removeEventListener(EventName.MOVIE_CREATE_SUCCESS,this.createWeaponComplete,this),this._weaponMc.dispos(),this._weaponMc=null)},t.roleUrl="resource/art/movie/body/{0}/{1}",t.ROLEKEY="body00{0}_{1}_{2}{3}",t.WEAPONKEY="weapon000_1_{0}{1}",t.WEAPONURL="resource/art/movie/weapon/{0}",t}(egret.DisplayObjectContainer);egret.registerClass(Avatar,"Avatar");var BaseRole=function(e){function t(){e.call(this),this._startPoint=null,this._isMoving=!1,this._onlyKey="",this.runEndFunc=null,t._index++,this._onlyKey="baseRole"+t._index,this._startPoint=new egret.Point(0,0),this._avatar=new Avatar,this.addChild(this._avatar)}__extends(t,e);var i=__define,n=t,a=n.prototype;return i(a,"isMoving",function(){return this._isMoving},function(e){this._isMoving=e,e?LoopManager.addToFrame(this._onlyKey,this.loop,this):LoopManager.removeFromFrame(this._onlyKey)}),i(a,"roleData",function(){return this._roleData}),a.setRoleData=function(e){this._roleData=e,this._avatar.setAvatarData(e)},a.loop=function(e){e._isMoving&&e.move()},a.move=function(){var e=egret.getTimer(),t=(e-this._startTime)/1e3;this.x=Math.floor(this._startPoint.x+this._curSpeedX*t),this.y=Math.floor(this._startPoint.y+this._curSpeedY*t),e>=this._endTime&&(this.x=this._targetPoint.x,this.y=this._targetPoint.y,null!=this._movePaths&&this._movePaths.length>0?this.doNextMove():(this.runEndFunc&&(this.runEndFunc(),this.runEndFunc=null),this.doStandAct()))},a.removePath=function(){this._movePaths&&this._movePaths.length>0&&(this._movePaths.length=0)},a.startMove=function(e,t){void 0===t&&(t=null),this._movePaths=e,0==e.length?this.doStandAct():(this.isMoving=!0,this.runEndFunc=t,this.doNextMove())},a.doNextMove=function(){var e=this._movePaths;if(null!=e&&e.length>0){this._startPoint.x=this.x,this._startPoint.y=this.y,this._targetPoint=e.pop();var t=this._startPoint.x,i=this._startPoint.y,n=this._targetPoint.x,a=this._targetPoint.y,r=egret.Point.distance(this._startPoint,this._targetPoint),o=r/this._roleData.speed;0==o&&(o=.001);var s=this.getDirection(this._targetPoint);this._roleData.dir=s,this._startTime=egret.getTimer(),this._curSpeedX=(n-t)/o,this._curSpeedY=(a-i)/o,this._endTime=this._startTime+Math.floor(1e3*o),this.doRunAct()}},a.stopMove=function(){this.isMoving=!1,this.removePath(),this.doStandAct()},a.doRunAct=function(){this._roleData.state=RoleState.ROLE_RUN,this._avatar.upDataAct()},a.doStandAct=function(){this._targetPoint=null,this._roleData.state=RoleState.ROLE_STAND,this.isMoving=!1,this._avatar.upDataAct()},a.doAttackAct=function(){this._targetPoint=null,this._roleData.state=RoleState.ROLE_ATTACK,this.isMoving=!1,this._avatar.upDataAct()},a.getDirection=function(e){var t=e.x,i=e.y,n=0,a=t-this.x,r=this.y-i;if(0==a&&0==r)return this.roleData.dir;var o=180*Math.atan2(r,a)/Math.PI;return o>=67&&112>o?SceneType.TOP:o>=22&&67>o?SceneType.RIGHT_TOP:o>=-22&&22>o?SceneType.RIGHT:o>=-67&&-22>o?SceneType.RIGHT_BOTTOME:o>=-112&&-67>o?SceneType.BOTTOM:o>=-157&&-112>o?SceneType.LEFT_BOTTOME:-157>o||o>=157?SceneType.LEFT:o>=112&&157>o?SceneType.LEFT_TOP:n},a.remove=function(){this.parent&&this.parent.removeChild(this),this.isMoving=!1,this._roleData=null,this._avatar.clear(),this.runEndFunc=null,this.removePath()},t._index=0,t}(egret.DisplayObjectContainer);egret.registerClass(BaseRole,"BaseRole");var BaseRoleData=function(){function e(){this.level=15,this.speed=160}var t=(__define,e);t.prototype;return e}();egret.registerClass(BaseRoleData,"BaseRoleData");var RoleState=function(){function e(){}var t=(__define,e);t.prototype;return e.ROLE_STAND="s",e.ROLE_RUN="r",e.ROLE_ATTACK="a",e.ROLE_C="c",e.STATES={0:e.ROLE_STAND,1:e.ROLE_RUN,2:e.ROLE_ATTACK,3:e.ROLE_C},e}();egret.registerClass(RoleState,"RoleState");var RoleType=function(){function e(){}var t=(__define,e);t.prototype;return e.TYPE_PLAYER=1,e.TYPE_MONSTER=2,e.TYPE_NPC=3,e}();egret.registerClass(RoleType,"RoleType");var SceneType=function(){function e(){}var t=(__define,e);t.prototype;return e.TOP=0,e.RIGHT_TOP=1,e.RIGHT=2,e.RIGHT_BOTTOME=3,e.BOTTOM=4,e.LEFT_BOTTOME=5,e.LEFT=6,e.LEFT_TOP=7,e}();egret.registerClass(SceneType,"SceneType");var LoopManager=function(){function e(){}var t=__define,i=e;i.prototype;return e.init=function(t){if(0==e._isInited){e.frameLoopDic={},e.timeoutDic={},e.timeLoopDic={},e.secondLoopDic={},e.stage=t,e.stage.addEventListener(egret.Event.ENTER_FRAME,e.frameLoop,null),e._isInited=!0,e._currentTime=egret.getTimer();var i=new egret.Timer(1e3);i.addEventListener(egret.TimerEvent.TIMER,e.onTimerIntvel,e),i.start()}},e.frameLoop=function(t){e.doFrameRate();var i,n=e.frameLoopDic;for(var a in n)if(i=e.frameLoopDic[a],null!=i){var r=i.handler;r(i.param)}e._curTime-e._timeTime>=100&&(e._timeTime=e._curTime,e.timerLoop())},e.timerLoop=function(){var t;for(var i in e.timeoutDic)t=e.timeoutDic[i],e._curTime-t.startTime>=t.count&&(t.handler.apply(null,t.arg),e.timeoutDic[t.key]=null,delete e.timeoutDic[t.key]);for(i in e.timeLoopDic)t=e.timeLoopDic[i],e._curTime-t.startTime>=t.count&&(t.startTime=e._curTime,t.handler.apply(null,t.arg))},e.onTimerIntvel=function(t){var i;for(var n in e.secondLoopDic)i=e.secondLoopDic[n],i.handler(i.param)},e.addToFrame=function(t,i,n){void 0===n&&(n=null);var a=e.frameLoopDic;if(null==a[t]){var r={handler:i,param:n};e.frameLoopDic[t]=r}},e.removeFromFrame=function(t){e.frameLoopDic[t]&&(e.frameLoopDic[t]=null,delete e.frameLoopDic[t])},e.hasFrame=function(t){return e.frameLoopDic[t]?!0:!1},e.addToSecond=function(t,i,n){if(null==e.secondLoopDic[t]){var a={handler:i,param:n};e.frameLoopDic[t]=a}},e.removeFromSceond=function(t){e.secondLoopDic[t]&&(e.secondLoopDic[t]=null,delete e.secondLoopDic[t])},e.hasScendKey=function(t){return e.secondLoopDic[t]?!0:!1},e.setTimeout=function(t,i,n){if(void 0===n&&(n=null),0==i)return t.apply(null,n),0;e.delayIDKey++;var a={key:e.delayIDKey,startTime:egret.getTimer(),count:i,handler:t,arg:n};return null==e.timeoutDic[e.delayIDKey]&&(e.timeoutDic[e.delayIDKey]=a),e.delayIDKey},e.clearTimeout=function(t){e.timeoutDic[t]&&(e.timeoutDic[t]=null,delete e.timeoutDic[t])},e.hasTimeout=function(t){return null!=e.timeoutDic[t]},e.setInterval=function(t,i,n){if(void 0===n&&(n=null),0==i)return t.apply(null,n),0;e.delayIDKey++;var a={key:e.delayIDKey,startTime:egret.getTimer(),count:i,handler:t,arg:n};return null==e.timeLoopDic[e.delayIDKey]&&(e.timeLoopDic[e.delayIDKey]=a),e.delayIDKey},e.clearInterval=function(t){e.timeLoopDic[t]&&(e.timeLoopDic[t]=null,delete e.timeLoopDic[t])},e.hasInterval=function(t){return null!=e.timeLoopDic[t]},t(e,"realRate",function(){return e._realFrameRate}),t(e,"frameHold",function(){return e._frameHold}),e.doFrameRate=function(){e._currentFrame++,e._curTime=egret.getTimer(),e._currentTime=e._curTime,e._frameHold=e._curTime-e.lastTime,e.lastTime=e._curTime,e.secFrames++,e._curTime-e.frameTime>=1e3&&(e._realFrameRate=e.secFrames,e.frameTime=e._curTime,e.secFrames=0)},t(e,"currentFrame",function(){return e._currentFrame}),t(e,"currentTime",function(){return e._currentTime}),e.frameToTime=function(t){return t*(1e3/e.stage.frameRate)},e.timeToFrame=function(t){return t/1e3*e.stage.frameRate},e._isInited=!1,e._currentFrame=0,e._currentTime=0,e._curTime=0,e.lastTime=0,e._realFrameRate=30,e._timeTime=0,e._secondTime=0,e.delayIDKey=0,e._frameHold=30,e.secFrames=0,e.frameTime=0,e}();egret.registerClass(LoopManager,"LoopManager");var SecondWindow=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createComplete,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createComplete=function(e){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closePanel,this)},n.closePanel=function(e){this.parent&&(this.parent.isPop=!1)},n.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},n.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);egret.registerClass(SecondWindow,"SecondWindow",["eui.UIComponent"]);var UiWindow=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createComplete,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createComplete=function(e){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closePanel,this)},n.closePanel=function(e){this.parent&&(this.parent.isPop=!1)},n.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},n.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);egret.registerClass(UiWindow,"UiWindow",["eui.UIComponent"]);var CustomButton=function(e){function t(){e.call(this),this._btnImg=null,this.touchEnabled=!0,this._btnImg=new CustomImage,this.addChild(this._btnImg),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_ROLL_OUT,this.onTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchHandler,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setUrl=function(e){this._btnImg.url=e},n.setTexture=function(e){this._btnImg.texture=e},n.onTouchHandler=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:this._btnImg.x=1,this._btnImg.y=1;break;case egret.TouchEvent.TOUCH_TAP:case egret.TouchEvent.TOUCH_ROLL_OUT:this._btnImg.x=0,this._btnImg.y=0}},t}(egret.Sprite);egret.registerClass(CustomButton,"CustomButton");var CustomImage=function(e){function t(){e.call(this),this._url="",this._cbmd=null}__extends(t,e);var i=__define,n=t,a=n.prototype;return i(a,"url",void 0,function(e){this._url!=e&&App.ins.resManager.getImageRes(e,this.oLoadComplete,this,LoadPriorityEnum.IMAGE_PRIORITY)}),a.oLoadComplete=function(e){var i=e.data;i._cbmd=e.bmd,i._cbmd.count(!0),i.texture=e.bmd.texture,i.dispatchEvent(new egret.Event(t.LOAD_IMG_COMPLETE))},a.dispos=function(){this.parent&&this.parent.removeChild(this),this.texture&&(this.texture.dispose(),this.texture=null),this._cbmd&&(this._cbmd.count(!1),this._cbmd=null)},t.LOAD_IMG_COMPLETE="load_img_complete",t}(egret.Bitmap);egret.registerClass(CustomImage,"CustomImage");var CustomNumImg=function(e){function t(t){e.call(this),this.resKey="{0}{1}_png",this.touchEnabled=!1,this._head=t}__extends(t,e);var i=(__define,t),n=i.prototype;return n.upDataNum=function(e){this.clear();for(var t=0,i=0;i<e.length;i++){var n=e.charAt(i);n=StringUtil.substitute(this.resKey,this._head,n);var a=new egret.Bitmap(RES.getRes(n));a.x=t,t+=a.width,this.addChild(a)}},n.clear=function(){for(;this.numChildren>0;){var e=this.removeChildAt(0);e.texture=null}},t}(egret.DisplayObjectContainer);egret.registerClass(CustomNumImg,"CustomNumImg");var CustomToggleGroup=function(e){function t(){e.call(this),this._toggleArr=null,this._selectTab=null,this._toggleArr=[]}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.setToggleBtn=function(e){-1==this._toggleArr.indexOf(e)&&(this._toggleArr.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTabHandler,this))},i(a,"selectTab",function(){return this._selectTab},function(e){this._selectTab!=e&&(this._selectTab&&(this._selectTab.selected=!1,this._selectTab.enabled=!0),this._selectTab=e,this._selectTab.enabled=!1,this._selectTab.selected=!0,this.dispatchEvent(new egret.Event(egret.Event.CHANGE)))}),a.onTouchTabHandler=function(e){this._selectTab!=e.currentTarget&&(this.selectTab=e.currentTarget)},t}(egret.EventDispatcher);egret.registerClass(CustomToggleGroup,"CustomToggleGroup");var UiManager=function(){function e(){}var t=(__define,e);t.prototype;return e.init=function(){e._viewContainer=App.ins.layer.windowLayer,e._alertContainer=App.ins.layer.popAlertLayer},e.show=function(t){1==t.viewType&&e._viewContainer.addChild(t),2==t.viewType&&-1==e._viewForMasks.indexOf(t)&&(e._alertContainer.addChild(t),e._viewForMasks.push(t),1==e._viewForMasks.length&&e.drawMask()),e.setPanelPosition(t)},e.hide=function(t){if(1==t.viewType&&e._viewContainer.contains(t)&&e._viewContainer.removeChild(t),2==t.viewType&&-1!=e._viewForMasks.indexOf(t)){var i=e._viewForMasks.indexOf(t);e._viewForMasks.splice(i,1),e._viewForMasks.length<1&&e.clearMask(),e._alertContainer.contains(t)&&e._alertContainer.removeChild(t)}},e.setPanelPosition=function(e){if(null!=e.parent){var t=App.ins.stage.stageWidth,i=App.ins.stage.stageHeight;e.x=Math.floor((t-e.panelW)/2),e.y=Math.floor((i-e.panelH)/2)}},e.drawMask=function(){e._alertContainer.graphics.clear(),e._alertContainer.graphics.beginFill(0,.7),e._alertContainer.graphics.drawRect(0,0,App.ins.stage.stageWidth,App.ins.stage.stageHeight),e._alertContainer.graphics.endFill(),e._alertContainer.touchEnabled=!0},e.clearMask=function(){e._alertContainer.graphics.clear(),e._alertContainer.touchEnabled=!1},e._viewContainer=null,e._alertContainer=null,e._viewForMasks=[],e}();egret.registerClass(UiManager,"UiManager");var BaseView=function(e){function t(t,i,n){void 0===t&&(t=1),void 0===i&&(i=0),void 0===n&&(n=0),e.call(this),this.viewType=0,this._isPop=!1,this.viewType=t,this._panelW=i,this._panelH=n,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.onCreateComplete,this)}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.onCreateComplete=function(e){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.onCreateComplete,this),this.addEvent()},a.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},a.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i(a,"isPop",function(){return this._isPop},function(e){this._isPop!=e&&(this._isPop=e,e?UiManager.show(this):UiManager.hide(this))}),i(a,"panelW",function(){return 0==this._panelW&&(this._panelW=this.width),this._panelW}),i(a,"panelH",function(){return 0==this._panelH&&(this._panelH=this.height),this._panelH}),a.addEvent=function(){throw"需要被重写"},a.removeEvent=function(){throw"需要被重写"},t}(eui.Component);egret.registerClass(BaseView,"BaseView",["eui.UIComponent"]);var GlobUrl=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(GlobUrl,"GlobUrl");var Message=function(){function e(){}var t=(__define,e);t.prototype;return e.show=function(t){null==e.layer&&(e.layer=App.ins.layer.msgLayer);var i=null,n=e.items;n.length>=e.maxCount&&(i=n.shift(),i.dispos()),i=MessageItem.getItem(),i.setMsg(t);for(var a=i.height,r=n.length-1;r>=0;r--){var o=n[r];o.upTo(a),a=o.height}n.push(i),i.alpha=1,i.x=(App.ins.stage.stageWidth-i.width)/2,i.y=e.fixedY,i.addToContainer()},e.removeItem=function(t){var i=e.items.indexOf(t);-1!=i&&e.items.splice(i,1)},e.layer=null,e.maxCount=3,e.items=[],e.fixedY=400,e}();egret.registerClass(Message,"Message");var MessageItem=function(e){function t(){e.call(this),this._removeKey=0,this._count=0,this._msgTxt=null,this._msgBackImg=null,null==t._pools&&(t._pools=new Array),this._msgBackImg=new eui.Image,this._msgBackImg.texture=RES.getRes("zjm_11"),this._msgBackImg.scale9Grid=new egret.Rectangle(5,5,5,5),this.addChild(this._msgBackImg),this._msgTxt=new egret.TextField,this._msgTxt.x=6,this._msgTxt.y=6,this._msgTxt.textColor=16776960,this._msgTxt.stroke=2,this._msgTxt.strokeColor=0,this._msgTxt.size=20,this._msgTxt.bold=!0,this._msgTxt.wordWrap=!1,this._msgTxt.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this._msgTxt)}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.upTo=function(e){var t=egret.Tween.get(this);t.to({y:this.y-e},200)},a.setMsg=function(e){this._msgTxt.textFlow=HtmlUtil.getHtmlStr(e),this._msgBackImg.width=this._msgTxt.textWidth+3+12,this._msgBackImg.height=this._msgTxt.textHeight+3+12},i(a,"width",function(){return this._msgBackImg.width}),i(a,"height",function(){return this._msgBackImg.height}),a.addToContainer=function(){function e(){this._removeKey=egret.setTimeout(i,this,t.defaultStayTime)}function i(){function e(e){Message.removeItem(a),a.dispos()}var t=egret.Tween.get(a);t.to({y:a.y-10,alpha:.1},500),t.call(e,a)}this.clearKey();var n=Message.layer;n.addChild(this),this.alpha=0,this.y=200;var a=this,r=egret.Tween.get(this);r.to({alpha:1},300).call(e,this)},a.clearKey=function(){0!=this._removeKey&&(egret.clearTimeout(this._removeKey),this._removeKey=0)},a.dispos=function(){egret.Tween.removeTweens(this),this.parent&&this.parent.removeChild(this),t._pools.push(this),this.clearKey()},t.getItem=function(){return t._pools.length>0?t._pools.shift():new t},t._pools=new Array,t.defaultStayTime=1500,t.upMoveY=30,t}(egret.DisplayObjectContainer);egret.registerClass(MessageItem,"MessageItem");var BaseModule=function(){function e(){this._dispatch=null,this._dispatch=GameDispatcher.ins}var t=__define,i=e,n=i.prototype;return n.startup=function(){throw new Error("需要被重写")},n.openView=function(){},t(n,"moduleName",function(){return"未被重写的模块名称"}),n.initListeners=function(){throw new Error("需要被重写")},n.addSocketListener=function(e,t){},n.removeSocketListener=function(e,t){},n.sendSocketMessage=function(e){},n.dispatch=function(e,t){void 0===t&&(t=null),this._dispatch.dispatchEventWith(e,t)},n.addModuleListener=function(e,t){this._dispatch.addEventListener(e,t,this)},n.removeModuleListener=function(e,t){},n.dispose=function(){},e}();egret.registerClass(BaseModule,"BaseModule");var ChatModule=function(e){function t(){e.call(this),this._chatView=null}__extends(t,e);var i=(__define,t),n=i.prototype;return n.startup=function(){this.initListeners()},n.initListeners=function(){},n.openView=function(){null==this._chatView&&(this._chatView=new ChatView),this._chatView.isPop=!0},t}(BaseModule);egret.registerClass(ChatModule,"ChatModule");var ChatView=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onCreateComplete=function(t){e.prototype.onCreateComplete.call(this,t),this.textInput.prompt="输入内容"},n.clickHandler=function(e){switch(e.currentTarget){case this.sendBtn:var t=this.textInput.text;Message.show(t);if("@OPEN_NODE"==t)GameDispatcher.ins.dispatchEvent(new egret.Event(EventName.OPEN_MAP_NODE));else if(-1!=t.indexOf("@MOVE_")){var i=t.split("_"),n={x:i[1],y:i[2]};GameDispatcher.ins.dispatchEvent(new egret.Event(EventName.AUTO_SEARCH_ROAD,!1,!1,n))}break;case this.openNodeBtn:GameDispatcher.ins.dispatchEvent(new egret.Event(EventName.AUTO_SEARCH_ROAD)),this.isPop=!1;break;case this.createBtn:GameDispatcher.ins.dispatchEventWith(EventName.OPEN_GM_PANEL,{type:1}),this.isPop=!1;break;case this.findBtn:GameDispatcher.ins.dispatchEventWith(EventName.OPEN_GM_PANEL,{type:2}),this.isPop=!1;break;case this.dressBtn:GameDispatcher.ins.dispatchEventWith(EventName.OPEN_GM_PANEL,{type:3}),this.isPop=!1}},n.addEvent=function(){this.sendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.openNodeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.createBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.findBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.dressBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},n.removeEvent=function(){},n.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},n.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(BaseView);egret.registerClass(ChatView,"ChatView",["eui.UIComponent"]);var CreateRoleView=function(e){function t(t){e.call(this),this.tab1=null,this.tab2=null,this.tab3=null,this.tab4=null,this.tab5=null,this.tab6=null,this.jobImg=null,this.jobDesTxt=null,this.nameTxt=null,this.starBtn=null,this.randomBtn=null,this._toggleGroup=null,this._roleData=null,this._module=t}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onCreateComplete=function(i){e.prototype.onCreateComplete.call(this,i);var n=new CustomToggleGroup;n.addEventListener(egret.Event.CHANGE,this.onToggleChangeHandelr,this),this._toggleGroup=n,n.setToggleBtn(this.tab1),n.setToggleBtn(this.tab2),n.setToggleBtn(this.tab3),n.setToggleBtn(this.tab4),n.setToggleBtn(this.tab5),n.setToggleBtn(this.tab6),this._roleData=new PlayerInfoData,n.selectTab=this.tab1;var a=t.names[Math.floor(Math.random()*(t.names.length-1))];this.nameTxt.text=a},n.onStartHandler=function(e){return""==this.nameTxt.text?void Message.show("请创建一个名字"):(this._roleData.name=this.nameTxt.text,void this._module.createRole(this._roleData))},n.onRandomHandler=function(e){var i=t.names[Math.floor(Math.random()*(t.names.length-1))];this.nameTxt.text=i},n.onNameChangeHandler=function(e){var t=e.target;t.text.length>8&&(t.text=t.text.slice(0,8))},n.onToggleChangeHandelr=function(e){var i=e.target,n=i.selectTab,a=0,r=0,o="";switch(n){case this.tab1:o="cjsc_06",r=0,a=1;break;case this.tab2:o="cjsc_06",r=1,a=1;break;case this.tab3:a=2,o="cjsc_07",r=0;break;case this.tab4:o="cjsc_07",r=1,a=2;break;case this.tab5:o="cjsc_08",r=0,a=3;break;case this.tab6:o="cjsc_08",r=1,a=3}this.jobImg.source=o,this.jobDesTxt.text=t.desObj[a],this._roleData.job=a,this._roleData.sex=r},n.dispos=function(){this.isPop=!1,this.removeEvent(),RES.destroyRes("cjjs")},n.addEvent=function(){this.nameTxt.addEventListener(egret.Event.CHANGE,this.onNameChangeHandler,this),this.starBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartHandler,this),this.randomBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRandomHandler,this)},n.removeEvent=function(){this._toggleGroup.removeEventListener(egret.Event.CHANGE,this.onToggleChangeHandelr,this),this.nameTxt.removeEventListener(egret.Event.CHANGE,this.onNameChangeHandler,this),this.starBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartHandler,this),this.randomBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRandomHandler,this)},n.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},n.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.names=["2呵","2v","卖萌的婷婷","榔头","傻z","逗比盖","大表哥","土豪炳","逗比摸头","流星"],t.desObj={1:"近战物理职业，通过暴力摧毁敌人",2:"魔法职业，拥有最强大的远程群体攻击",3:"兼顾远程输出和辅助的职业，还能召唤宠物攻击"},t}(BaseView);egret.registerClass(CreateRoleView,"CreateRoleView",["eui.UIComponent"]);var FeatureChangeView=function(e){function t(){e.call(this,2)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onCreateComplete=function(t){e.prototype.onCreateComplete.call(this,t)},n.addEvent=function(){this.sexBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.jobBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.dressBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},n.clickHandler=function(e){e.currentTarget==this.sexBtn?GameDispatcher.ins.dispatchEventWith(EventName.CHANGE_FEATURE,{key:"sex"}):e.currentTarget==this.jobBtn?GameDispatcher.ins.dispatchEventWith(EventName.CHANGE_FEATURE,{key:"job"}):e.currentTarget==this.dressBtn&&GameDispatcher.ins.dispatchEventWith(EventName.CHANGE_FEATURE,{key:"dress"}),this.isPop=!1},n.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},n.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(BaseView);egret.registerClass(FeatureChangeView,"FeatureChangeView",["eui.UIComponent"]);var GmModule=function(e){function t(){e.call(this),this._featureChangeView=null}__extends(t,e);var i=(__define,t),n=i.prototype;return n.startup=function(){this.initListeners()},n.initListeners=function(){this.addModuleListener(EventName.OPEN_GM_PANEL,this.onOpenGmHandler)},n.onOpenGmHandler=function(e){switch(e.data.type){case 1:Message.show("不能创建角色");break;case 2:Message.show("没有其他人");break;case 3:null==this._featureChangeView&&(this._featureChangeView=new FeatureChangeView),this._featureChangeView.isPop=!0}},t}(BaseModule);egret.registerClass(GmModule,"GmModule");var MainModule=function(e){function t(){e.call(this),this._createRole=null,this._mainView=null}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.startup=function(){null==this._createRole&&(this._createRole=new CreateRoleView(this),this._createRole.isPop=!0),this.initListeners()},a.initListeners=function(){},a.createRole=function(e){this.dispatch(EventName.CREATE_ROLE_SUCCESS,e),this._createRole.dispos(),this._createRole=null,this.initMainView(e)},a.initMainView=function(e){null==this._mainView&&(this._mainView=new MainView(this),App.ins.layer.mainLayer.addChild(this._mainView),this._mainView.setRoleData(e))},i(a,"moduleName",function(){return"主界面"}),t}(BaseModule);egret.registerClass(MainModule,"MainModule");var MainView=function(e){function t(t){e.call(this),this.testBtn=null,this._roleData=null,this._welcomView=null,this._module=t,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.onCreateComplete,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onCreateComplete=function(e){this._viplvlImg=new CustomNumImg("5"),this._viplvlImg.x=150,this._viplvlImg.y=98,this.addChild(this._viplvlImg),this._fightNumImg=new CustomNumImg("4"),this._fightNumImg.x=165,this._fightNumImg.y=52,this.addChild(this._fightNumImg),this.addEvent(),this._welcomView=new WelcomView,this._welcomView.isPop=!0},n.setRoleData=function(e){this._roleData=e,this.nameTxt.text=e.name,this.lvlTxt.text=e.level+"级",this.yuanbaoTxt.text=e.yuanbao.toString(),this.yinbiTxt.text=e.yinbi.toString(),this.headImg.source="uihead"+e.job+e.sex+"_png",this._viplvlImg.upDataNum(e.vipLvl.toString()),this._fightNumImg.upDataNum(e.fightNum.toString())},n.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},n.childrenCreated=function(){e.prototype.childrenCreated.call(this)},n.addEvent=function(){this.testBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTestHandler,this)},n.onTestHandler=function(e){App.ins.moduleManager.openModule(ModuleIdStatic.CHAT_MODULE)},t}(eui.Component);egret.registerClass(MainView,"MainView",["eui.UIComponent"]);var WelcomView=function(e){function t(){e.call(this),this._conatiner=null,this._conatiner=App.ins.layer.moduleLayer,this._backImg=new CustomImage,this._backImg.url=t.backUrl,this.addChild(this._backImg),this._startBtn=new CustomButton,this._startBtn.x=168,this._startBtn.y=430,this._startBtn.setTexture(RES.getRes("welcome_02")),this.addChild(this._startBtn),this._startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTab,this)}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.onTouchTab=function(e){this.isPop=!1},i(a,"isPop",void 0,function(e){e?(this.y=100,this._conatiner.addChild(this),this._conatiner.graphics.clear(),this._conatiner.graphics.beginFill(0,.6),this._conatiner.graphics.drawRect(0,0,App.ins.stage.stageWidth,App.ins.stage.stageHeight),this._conatiner.graphics.endFill(),this._conatiner.touchEnabled=!0):(this._conatiner.graphics.clear(),this._conatiner.touchEnabled=!1,this._conatiner.contains(this)&&this._conatiner.removeChild(this),this._backImg.dispos())}),t.backUrl="resource/art/img/welcome/welcome_01.png",t}(egret.Sprite);egret.registerClass(WelcomView,"WelcomView");var PlayerInfoData=function(e){function t(){e.call(this),this.yuanbao=0,this.yinbi=1e4,this.vipLvl=0,this.fightNum=1e3}__extends(t,e);var i=(__define,t);i.prototype;return t}(BaseRoleData);egret.registerClass(PlayerInfoData,"PlayerInfoData");var Monster=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setRoleData=function(t){t.type=RoleType.TYPE_MONSTER,e.prototype.setRoleData.call(this,t)},t}(BaseRole);egret.registerClass(Monster,"Monster");var Player=function(e){function t(){e.call(this),this._nameTxt=null,this.isSelf=!1,this._autoMove=!1,this.touchEnabled=!0;var t=new egret.TextField;t.textAlign=egret.HorizontalAlign.CENTER,t.size=14,t.filters=[new egret.GlowFilter(0,1,3,3,2,1)],t.text="12324",this._nameTxt=t,this.addChild(t),this._avatar.addEventListener(SceneEventName.UPDATA_ROLE_SIZE,this.refreshBodySize,this)}__extends(t,e);var i=__define,n=t,a=n.prototype;return i(a,"isMoving",void 0,function(e){this._isMoving=e,e?LoopManager.addToFrame(this._onlyKey,this.loop,this):(LoopManager.removeFromFrame(this._onlyKey),this._autoMove&&(this._autoMove=!1,this.autoMove()))}),a.autoMove=function(){if(this._autoMove)return this._autoMove=!1,void this.stopMove();this._autoMove=!0;var e=this.x+Math.floor(800*Math.random())-400,t=this.x+Math.floor(800*Math.random())-400,i=SceneManager.ins.mapData;e+200>i.mapWidth&&(e=i.mapWidth-200),0>e-200&&(e=200),t+200>i.mapHeight&&(t=i.mapHeight-200),0>t-200&&(t=200),SceneManager.ins.clickMap(e,t)},a.refreshBodySize=function(e){this._nameTxt.text=this.roleData.name,this._nameTxt.width=this._nameTxt.textWidth+3,this._nameTxt.x=-this._nameTxt.width/2,this._nameTxt.y=-this._avatar.bodyHeight-5},a.move=function(){if(null!=this._targetPoint){var e=egret.getTimer(),t=(e-this._startTime)/1e3;this.x=Math.floor(this._startPoint.x+this._curSpeedX*t),this.y=Math.floor(this._startPoint.y+this._curSpeedY*t),e>=this._endTime&&(this.x=this._targetPoint.x,this.y=this._targetPoint.y,null!=this._movePaths&&this._movePaths.length>0?this.doNextMove():(this.runEndFunc&&(this.runEndFunc(),this.runEndFunc=null),this.doStandAct())),this.isSelf&&GameDispatcher.ins.dispatchEventWith(SceneEventName.MY_ROLE_CHANGE_POSITION,{x:this.x,y:this.y})}},a.setRoleData=function(t){t.type=RoleType.TYPE_PLAYER,e.prototype.setRoleData.call(this,t)},a.remove=function(){this._avatar.removeEventListener(SceneEventName.UPDATA_ROLE_SIZE,this.refreshBodySize,this),this._nameTxt.filters=null,this.removeChild(this._nameTxt),this._nameTxt=null,e.prototype.remove.call(this)},t}(BaseRole);egret.registerClass(Player,"Player");var MapModule=function(e){function t(){e.call(this),this._sceneManager=null}__extends(t,e);var i=__define,n=t,a=n.prototype;return a.startup=function(){this._sceneManager=SceneManager.ins,this._mapView=new MapViewMediator(App.ins.layer.sceneLayer),this._sceneManager.mapViewMediator=this._mapView,this.initListeners()},a.initListeners=function(){this.addModuleListener(EventName.CREATE_ROLE_SUCCESS,this.onCreateRoleHandler),this.addModuleListener(EventName.OPEN_MAP_NODE,this.onOpenMapNode)},a.onOpenMapNode=function(e){this._mapView.backLayer.drawNodes(this._sceneManager.mapData)},a.onCreateRoleHandler=function(e){this._sceneManager.createMyRole(e.data),this._sceneManager.initMap()},a.openView=function(){},i(a,"moduleName",function(){return"地图模块"}),t}(BaseModule);egret.registerClass(MapModule,"MapModule");var SceneManager=function(){function e(){this.mapViewMediator=null,this._myRole=null,this._loadProxy=null,this._sceneProxy=null,this.myRoleData=null,this._isMapClick=!1,this._dispatcher=null,this._roleMap={},this._loadProxy=new MapLoadProxy,this._sceneProxy=new MapSceneProxy,this._dispatcher=GameDispatcher.ins,this.initListener()}var t=__define,i=e,n=i.prototype;return t(e,"ins",function(){return null==e._ins&&(e._ins=new e),e._ins}),n.initListener=function(){this._dispatcher.addEventListener(SceneEventName.MY_ROLE_CHANGE_POSITION,this.onChangeMyRolePoint,this),this._dispatcher.addEventListener(EventName.AUTO_SEARCH_ROAD,this.onAutoMapSearch,this),this._dispatcher.addEventListener(EventName.CHANGE_FEATURE,this.onChangeFeature,this)
},n.createMyRole=function(e){this._myRole=this.mapViewMediator.createMyRole(e),this.myRoleData=this._myRole.roleData},n.initMap=function(){this.clear(),LoopManager.addToFrame("sceneManager",this.onLoopHandler),this._loadProxy.setBgView(this.mapViewMediator.backLayer),this._loadProxy.setMapId(2),this._loadProxy.addEventListener(SceneEventName.GAMEMAP_DATA_LOAD_COMPLETE,this.mapLoadComplete,this)},t(n,"myRole",function(){return this._myRole}),n.mapLoadComplete=function(e){this.mapData=e.data,this.mapViewMediator.avatarLayer.addChild(this.myRole),null==this._transLine&&(this._transLine=new AcorrsLineGrid(e.data)),this._transLine.reset(e.data),this.resetMapView()},n.resetMapView=function(){this._isMapClick=!0;var e=this.myRoleData.nodeX*MapConfig.MAP_NODE_WIDTH*.5,t=this.myRoleData.nodeY*MapConfig.MAP_NODE_HEIGHT*.5;this._myRole.x=e,this._myRole.y=t,this._sceneProxy.upMapAreaRect(this.mapData.mapWidth,this.mapData.mapHeight),this._sceneProxy.upSceneRect(App.ins.stage.stageWidth,App.ins.stage.stageHeight),this._sceneProxy.setRolePoint(e,t),this._sceneProxy.moveScene(),this.mapViewMediator.map.updataPosition(this._sceneProxy.sceneRect.x,this._sceneProxy.sceneRect.y),this.randomRole()},n.onChangeMyRolePoint=function(e){var t=this._myRole.x,i=this._myRole.y;this._sceneProxy.setRolePoint(t,i,!0),this.mapViewMediator.map.updataPosition(this._sceneProxy.sceneRect.x,this._sceneProxy.sceneRect.y)},n.clickMap=function(e,t){if(null!=this._myRole){this._isMapClick=!0;var i=this.searchAstar(e,t,this.myRoleData.nodeX,this.myRoleData.nodeY);i&&i.length>0&&this._myRole.startMove(i)}},n.onLoopHandler=function(){var t=LoopManager.currentFrame;t%5==0&&(e.ins.checkMapClips(),t%6==0&&e.ins.mapViewMediator.avatarLayer.doSortAvatar())},n.checkMapClips=function(){function t(){var t=e.ins._sceneProxy.clips;e.ins._loadProxy.loadClips(t),e.ins.mapViewMediator.backLayer.clearClips(e.ins._sceneProxy.sceneRect.x,e.ins._sceneProxy.sceneRect.y)}this._isMapClick&&(this._isMapClick=!1,t()),null!=this.mapData&&this._myRole.isMoving&&t()},n.searchAstar=function(e,t,i,n,a){void 0===a&&(a=0);var r=e%MapConfig.MAP_NODE_WIDTH,o=t%MapConfig.MAP_NODE_HEIGHT,s=this.mapData.getNodeByXY(e,t),h=this.mapData.getNode(i,n),l=[];if(null==h||null==s)return null;if(h==s)return l.push(this.getPoint(r,o,s)),l;if(s=this.getEnd(s),!s.walkAble)for(var d=0,c=0;s&&!s.walkAble&&s!=h;)d=0,c=0,h.x>s.x?d=1:h.x<s.x&&(d=-1),h.y>s.y?c=1:h.y<s.y&&(c=-1),s=this.mapData.getNode(s.x+d,s.y+c);this.mapData.startNode=h,this.mapData.endNode=s;var u=Astart.findPath(this.mapData);if(null==u||u.length<=0)return null;var _;u=Astart.profect(u),u=this._transLine.getPsnode(u),u.pop();for(var p=0,g=u.length;g>p;p++)_=u[p],_==s?l.push(this.getPoint(r,o,_)):l.push(this.getPoint(0,0,_));return l},n.getPoint=function(e,t,i){var n;return null==n&&(n=new egret.Point),n.setTo(i.x*MapConfig.MAP_NODE_WIDTH+e,i.y*MapConfig.MAP_NODE_HEIGHT+t),n},n.getEnd=function(e){if(e.walkAble)return e;var t=null,i=null,n=-1,a=-1;for(n=-1;2>n;n++)for(a=-1;2>a;a++)if(t=this.mapData.getNode(e.x+n,e.y+a),t&&t.walkAble){i=t;break}return i||e},n.removeRoleByid=function(e){var t=this._roleMap[e];t&&(t.remove(),delete this._roleMap[e])},n.onAutoMapSearch=function(e){null!=e.data?this.clickMap(e.data.x,e.data.y):this._myRole.autoMove()},n.randomRole=function(){for(var e=0;50>e;e++){var t=this.mapViewMediator.createOtherPlayer();t.roleData.onlyid=e+1,t.roleData.name="士兵"+(e+1),this.mapViewMediator.avatarLayer.addChild(t),this._roleMap[e+1]=t}},n.onChangeFeature=function(e){var t=e.data.key,i=this.myRoleData;"sex"==t&&(i.sex=Math.floor(1*Math.random())),"job"==t&&(i.job=Math.floor(3*Math.random())),"dress"==t&&(i.dress=Math.floor(3*Math.random())),this._myRole.setRoleData(i)},n.clear=function(){this.mapViewMediator.clear(),this._loadProxy.clear();for(var e in this._roleMap){var t=this._roleMap[e];t.remove()}this._roleMap={}},e._ins=null,e.roleIndex=0,e}();egret.registerClass(SceneManager,"SceneManager");var MapViewMediator=function(){function e(e){this._mapBackLayer=null,this._mapAvatarLayer=null,this._mapEffectLayer=null,this._parent=e,this.init()}var t=__define,i=e,n=i.prototype;return n.init=function(){this._map=new MapContainer,this._parent.addChild(this._map),this._mapBackLayer=new MapBackGroundLayer,this._mapEffectLayer=new MapEffectLayer,this._mapAvatarLayer=new MapAvatarLayer,this._map.addChild(this._mapBackLayer),this._map.addChild(this._mapEffectLayer),this._map.addChild(this._mapAvatarLayer),this._mapAvatarLayer.init(),this._map.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMapClick,this)},n.onMapClick=function(e){SceneManager.ins.clickMap(e.localX,e.localY)},t(n,"map",function(){return this._map}),t(n,"backLayer",function(){return this._mapBackLayer}),t(n,"effectLayer",function(){return this._mapEffectLayer}),t(n,"avatarLayer",function(){return this._mapAvatarLayer}),n.createMyRole=function(e){var t=new Player;t.isSelf=!0,e.dir=4,e.dress=0,e.level=Math.floor(80*Math.random()+10);var i=Math.floor(3.9*Math.random()),n=RoleState.STATES;n[i];return e.state=RoleState.ROLE_STAND,e.nodeX=Math.floor(22*Math.random())+22,e.nodeY=Math.floor(22*Math.random())+22,t.setRoleData(e),t},n.createOtherPlayer=function(){var e=new Player,t=new PlayerInfoData;e.isSelf=!1,t.dir=4,t.sex=Math.floor(1*Math.random()),t.dress=Math.floor(3*Math.random()),t.level=Math.floor(80*Math.random()+10);var i=Math.floor(3.9*Math.random()),n=RoleState.STATES,a=n[i];return t.state=a,t.nodeX=Math.floor(43*Math.random())+4,t.nodeY=Math.floor(43*Math.random())+4,e.setRoleData(t),e.x=t.nodeX*MapConfig.MAP_NODE_WIDTH+.5*MapConfig.MAP_NODE_WIDTH,e.y=t.nodeY*MapConfig.MAP_NODE_HEIGHT+.5*MapConfig.MAP_NODE_HEIGHT,e},n.clear=function(){this._mapBackLayer.clear(),this._mapEffectLayer.clear(),this._mapAvatarLayer.clear()},e}();egret.registerClass(MapViewMediator,"MapViewMediator");var ModuleManager=function(){function e(){this.setModules()}var t=(__define,e),i=t.prototype;return i.startModule=function(){for(var e in this._modules)this._modules[e].startup()},i.setModules=function(){this._modules={},this._modules[ModuleIdStatic.GM_MODULE]=new GmModule,this._modules[ModuleIdStatic.MAP_MODULE]=new MapModule,this._modules[ModuleIdStatic.MAIN_MODULE]=new MainModule,this._modules[ModuleIdStatic.CHAT_MODULE]=new ChatModule},i.openModule=function(e,t){void 0===t&&(t=0);var i=this._modules[e];i.openView()},e}();egret.registerClass(ModuleManager,"ModuleManager");var EventName=function(){function e(){}var t=(__define,e);t.prototype;return e.CHANGE_FEATURE="change_feature",e.OPEN_GM_PANEL="open_gm_panel",e.OPEN_MAP_NODE="open_map_node",e.OPEN_MODULE_VIEW="open_module_view",e.CREATE_ROLE_SUCCESS="create_role_success",e.MOVIE_CREATE_SUCCESS="movie_create_success",e.AUTO_SEARCH_ROAD="auto_search_road",e}();egret.registerClass(EventName,"EventName");var GameDispatcher=function(e){function t(){e.call(this),t._dispatcher=new egret.EventDispatcher}__extends(t,e);var i=__define,n=t,a=n.prototype;return i(t,"ins",function(){return null==t._ins&&(t._ins=new t),t._ins}),a.dispatchEvent=function(t){return e.prototype.dispatchEvent.call(this,t)},a.dispatchEventWith=function(t,i){return e.prototype.dispatchEventWith.call(this,t,!1,i)},t}(egret.EventDispatcher);egret.registerClass(GameDispatcher,"GameDispatcher");var HtmlUtil=function(){function e(){}var t=(__define,e),i=t.prototype;return e.getHtmlStr=function(t){var i=e.htmlParser.parser(t);return i},i.test=function(){},e.htmlParser=new egret.HtmlTextParser,e}();egret.registerClass(HtmlUtil,"HtmlUtil");var ModuleIdStatic=function(){function e(){}var t=(__define,e);t.prototype;return e.GM_MODULE=0,e.MAP_MODULE=11,e.MAIN_MODULE=1101,e.CHAT_MODULE=12,e}();egret.registerClass(ModuleIdStatic,"ModuleIdStatic");var StringUtil=function(){function e(){}var t=(__define,e);t.prototype;return e.toboolean=function(e){return null==e?!1:"false"==e?!1:0==e?!1:!0},e.getDay=function(e,t){return 0},e.formatNum=function(e){var t=e.toString();if(t.length>3){for(var i,n=new Array,a=t.length;a>0;)i=Math.max(a-3,0),n.unshift(t.slice(i,a)),a=i;t=n.join(",")}return t},e.GetStringLength=function(e,t){void 0===t&&(t="gb2312");var i=new egret.ByteArray;return i.length},e.getWeekDay=function(e){var t=["日","一","二","三","四","五","六"];return t[e]},e.getChieseNum=function(e){var t=["零","一","二","三","四","五","六","七","八","九","十"];return t[e]},e.formatToTime=function(e){var t=e%60,i=(e-t)/60%60,n=(e-60*i-t)/3600,a=10>t?"0"+t.toString():t.toString(),r=10>i?"0"+i.toString():i.toString(),o=10>n?"0"+n.toString():n.toString();return o+":"+r+":"+a},e.formatToTime_V2=function(e){var t=e%60,i=(e-t)/60%60,n=(e-60*i-t)/3600,a=0==i?"":i.toString()+"分",r=0==n?"":n.toString()+"小时";return r+a+t+"秒"},e.formatToTime_V3=function(e){var t=e%60,i=(e-t)/60%60,n=(e-60*i-t)/3600,a=10>i?"0"+i:i.toString(),r=10>n?"0"+n:n.toString();return r+"时"+a+"分"},e.formatToTime_V4=function(e){var t=e%60,i=(e-t)/60%60,n=10>i?"0"+i:i.toString(),a=10>t?"0"+t:t.toString();return n+"分"+a+"秒"},e.convertTime=function(e,t){void 0===t&&(t=":");var i=Math.ceil(e/3600),n=Math.ceil(e%3600/60),a=Math.ceil(e%60);return(10>i?"0"+i:""+i)+t+(10>n?"0"+n:""+n)+t+(10>a?"0"+a:""+a)},e.resloveFormatLastLoginTime=function(e){var t="";return t},e.resloveFormatLastLoginTime2=function(e){var t=e%60,i=(e-t)/60%60,n=(e%86400-60*i-t)/3600,a=Math.floor(e/86400),r=10>t?"0"+t.toString():t.toString(),o=10>i?"0"+i.toString():i.toString(),s=10>n?"0"+n.toString():n.toString(),h="";return a>0&&(h=a+"天"),h+s+"时"+o+"分"+r+"秒"},e.formatTimeToDay=function(e){var t="";return t},e.formatTimeToMin=function(e){var t="";new Date(1e3*e);return t},e.formatTimeToMin2=function(e){var t="";new Date(1e3*e);return t},e.formatTimeToMin3=function(e){var t="";new Date(1e3*e);return t},e.replaceAllBySplit=function(e,t,i){return null==e?null:e.split(t).join(i)},e.replaceAllByRegex=function(e,t,i){return null==e?null:e.replace(new RegExp(t,"g"),i)},e.randRange=function(e,t){var i=Math.floor(Math.random()*(t-e+1))+e;return i},e.checkNameLength=function(e,t,i){void 0===t&&(t=16),void 0===i&&(i="gb2312");var n="";return n},e.formatTimeToMinSec=function(e){var t=e/60,i=e%60,n=(t>=10?t:"0"+t)+":"+(i>=10?i:"0"+i);return n},e.substitute=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n,a=t.length;1==a&&egret.is(t[0],"Array")?(n=t[0],a=n.length):n=t,e=e.replace(/\\t/g,"	");for(var r=0;a>r;r++)e=e.replace(new RegExp("\\{"+r+"\\}","g"),n[r]);return e},e.getStringLen=function(e,t){void 0===t&&(t=2);var i=0;if(e){for(var n="",a=0;t>a;a++)n+="x";i=e.replace(/[^\x00-\xff]/g,n).length}return i},e}();egret.registerClass(StringUtil,"StringUtil");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(e,t,i){this.textField.text="Loading  "+e+"资源..."+t+"/"+i,egret.log(this.textField.text)},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),App.ins.init(this.stage),App.ins.layer.initLayer(this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(e){"preload"==e.groupName?RES.loadGroup("common"):"common"==e.groupName?RES.loadGroup("cjjs"):"cjjs"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){this.loadingView.setProgress(e.groupName,e.itemsLoaded,e.itemsTotal)},n.startCreateScene=function(){App.ins.moduleManager=new ModuleManager,App.ins.moduleManager.startModule()},n.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function a(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);